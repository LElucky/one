<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="__STATIC__/admin/css/bootstrap.min.css" />
<link rel="stylesheet" href="__STATIC__/admin/css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="__STATIC__/admin/css/uniform.css" />
<link rel="stylesheet" href="__STATIC__/admin/css/select2.css" />
<link rel="stylesheet" href="__STATIC__/admin/css/matrix-style.css" />
<link rel="stylesheet" href="__STATIC__/admin/css/matrix-media.css" />
<link href="__STATIC__/admin/font-awesome/css/font-awesome.css" rel="stylesheet" />
<link href='__STATIC__/admin/css/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="__STATIC__/admin/css/admin.css" />
<script src="__STATIC__/admin/js/jquery.min.js"></script> 
<link href="__STATIC__/admin/back_style/css/jquery.circliful.css" rel="stylesheet" type="text/css" />
<link href="__STATIC__/admin/back_style/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<script src="__STATIC__/admin/back_style/js/jquery.circliful.js"></script>
<script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
<style>
	.editimg{ max-width:400px;}
</style>
<div id="content">
	<div id="content-header">
		<div id="breadcrumb"> 
			<a href="#" class="tip-bottom">
				<i class="icon-home"></i>
				后台管理
			</a> 
			<a href="#" class="current">数据库备份管理</a> <a href="#" class="current">数据库备份管理</a>
		</div>
		<h1>数据库备份</h1>
	</div>
	<div class="container-fluid">
		<hr>
		<div class="row-fluid">
			<div class="span12">
				<div class="widget-box">
					<div class="widget-title"> 
						<span class="icon"> <i class="icon-align-justify"></i> </span>
						<h5>数据库备份</h5>
					</div>
					<div class="widget-content nopadding">
						<form action="" method="post" class="form-horizontal" enctype="multipart/form-data">

							<div class="control-group">
								<label class="control-label">数据库_link:	</label>
								<div class="controls">
									<input type="text" name="link" class="span6" placeholder="link" value="{$Think.config.database.hostname}">
								</div>
							</div>

							<div class="control-group">
								<label class="control-label">数据库_user:</label>
								<div class="controls">
									<input type="text" name="user" class="span6" placeholder="user">
								</div>
							</div>

							<div class="control-group">
								<label class="control-label">数据库_pass:</label>
								<div class="controls">
									<input type="text" name="pass" class="span6" placeholder="pass" >
								</div>
							</div>


							<div class="control-group">
								<label class="control-label">数据库_库：</label>
								<div class="controls">
									<input type="text" name="database" class="span6" placeholder="database" value="{$Think.config.database.database}">
								</div>
							</div>
							<div class="control-group">
								<label class="control-label">数据库_dir：</label>
								<div class="controls">
									<input type="text" name="dir" class="span6" placeholder="为空默认备份在{$Think.ROOT_PATH}datasql">
									<s
								</div>
							</div>
							<div >
								<div id="tongji" style="width:500px;height:200px;position:absolute;right:5%;top:15%;"></div>
							</div>

								<input type="hidden" name="ajax_back_path" value="{:url('admin/databases/saveback')}">
							<div class="form-actions">
								<input type="button" value="备份" onclick="backup()" class="btn btn-success"/>
							
							</div>
						</form>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>


        <script>
            function backup()
            {

            	var link = $('[name="link"]').val()
            	var user = $('[name="user"]').val()
            	var pass = $('[name="pass"]').val()
            	var database = $('[name="database"]').val()
            	var dir  = $('[name="dir"]').val()
            	var path = $('[name="ajax_back_path"]').val()
            	if(link == '' || user == '' || pass == '' || database == '' ){
            		alert('请完整填写表单')
            		return false;
            	}
                $.ajax({
                    url: path,
                    type: 'POST', //POST
                    async: true, //或false,是否异步
                    data:{'link':link,'user':user,'pass':pass,'data':database,'dir':dir},
                    dataType: 'JSON',
                    success: function (data, textStatus, jqXHR) {
                        datainfo = '表[' + data.nowtable + ']完成' + data.tablepercentage + '%';
                        if (data.totalpercentage >= 100)
                        {
                            datainfo = '备份完成';
                        }

                        html = '<div id="myStat2" data-dimension="250" data-text="' + data.totalpercentage + '%" data-info="' + datainfo + '" data-width="30" data-fontsize="38" data-percent="' + data.totalpercentage + '" data-fgcolor="#61a9dc" data-bgcolor="#eee"></div>';
                        $('#tongji').html(html);
                     
                        $('#myStat2').circliful();
                        if (data.totalpercentage < 100)
                        {
                            backup();
                        }
                    }
                })
            }
        </script>





<script src="__STATIC__/admin/My97DatePicker/WdatePicker.js"/></script>

<script src="__STATIC__/admin/js/jquery.ui.custom.js"></script> 
<script src="__STATIC__/admin/js/bootstrap.min.js"></script>
<script src="__STATIC__/admin/js/bootstrap-colorpicker.js"></script> 
<script src="__STATIC__/admin/js/bootstrap-datepicker.js"></script> 
<script src="__STATIC__/admin/js/jquery.toggle.buttons.html"></script> 
<script src="__STATIC__/admin/js/masked.js"></script> 
<script src="__STATIC__/admin/js/jquery.uniform.js"></script>
<script src="__STATIC__/admin/js/matrix.js"></script> 
<script src="__STATIC__/admin/js/matrix.form_common.js"></script> 
<script src="__STATIC__/admin/js/wysihtml5-0.3.0.js"></script> 
<script src="__STATIC__/admin/js/jquery.peity.min.js"></script> 
<script src="__STATIC__/admin/js/bootstrap-wysihtml5.js"></script>