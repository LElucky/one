_.Module.define({path:"tbui/widget/http_transform",sub:{initial:function(){window.BaiduHttps||(window.BaiduHttps={callbacks:function(){}})},httpTransform:function(t){if(window.navigator.userAgent){var i=window.navigator.userAgent;i=i.toLowerCase();var a=new RegExp("/chrome|firefox|safari|msie 10|rsv:11|msie [89]/");a.test(i)&&(t=t.replace("http://www.baidu.com","https://www.baidu.com"))}return t},httpLinkHover:function(t){$(t).hover(function(){$.ajax({url:"https://www.baidu.com/con?from=tieba",type:"get",dataType:"JSONP"})})}}});_.Module.define({path:"frs-base/pagelet/content",sub:{initial:function(n){this.initialEvent(n)},initialEvent:function(n){var t=this;n.on("tab_change",function(o){Bigpipe.broadcast("tab_change_finish",o),$(n.document).addClass("pagelet-loading"),n.refresh({url:o.url}).then(function(){$(n.document).removeClass("pagelet-loading"),t.gotoTop()})})},gotoTop:function(){if($("#tb_nav")&&$("#tb_nav").offset()){var n=$("html, body").animate({scrollTop:$("#tb_nav").offset().top-50},250,"linear");$("window").on("scroll",function(){n.stop()})}}}});_.Module.define({path:"frs-footer/pagelet/content_footer",sub:{initial:function(t){var e=$(".editor_wrap_bright");t&&t.on("tab_change",function(t){var o=t.tab||"frs";"frs"===o?e.show():e.hide()})}}});1===$(".showBar").length&&$.stats.track("\u5e95\u90e8","\u65b0\u7528\u6237\u7ea2\u5305","frs","show"),$("#fixed_bar .close").on("click",function(){$.cookie("fixed_bar",1,{expires:1,path:"/"}),$("#fixed_bar").hide()});_.Module.define({path:"search/widget/suggestion/base",requires:["search/widget/suggestion/events"],sub:{runtime:{disabled:!1},initial:function(t){this.options=t,this.input=this.options.input,this.wrapper=this.options.fixWrapper,this.sug=null,this.dataList=[],this.create()},create:function(){var t=['<div class="#{expand}">','<ul class="#{expandList}">',"</ul>","</div>"].join(""),e=this.input,i=e.offset(),s=e.outerWidth()-2,a=e.outerHeight()+i.top-1,n=i.left,r=this.wrapper?this.wrapper:$("body");this.sug=$($.tb.format(t,this.options.classes)).css({left:n,width:s,top:a}).hide(),r.append(this.sug),this.ableControl(),this.bindEvents()},bindEvents:function(){this.requireInstance("search/widget/suggestion/events",[{input:this.input,sug:this.sug,options:this.options}])},ableControl:function(){var t=$('input.jointb[type="radio"]'),e=$('input.authortb[type="radio"]'),i=$('input.searchtb[type="radio"]');t.length>0&&t.bind("click",this.able()),e.length>0&&e.bind("click",this.able()),i.length>0&&i.bind("click",this.disable()),0!=t.length&&t.tbattr("checked")||this.disable()},able:function(){this.runtime.disabled=!1},disable:function(){this.runtime.disabled=!0,this.sug.hide()}}}),_.Module.define({path:"search/widget/suggestion/events",requires:["search/widget/suggestion/data"],sub:{skippedType:["operation_title","often_forum_title","relation_forum_title","relation_game_title","more_title"],initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.wrapper=this.options.options.fixWrapper,this.skipTime=this.options.options.skipTime,this.target=null,this.toggleFlag=!1,this.mouseIn=!1,this.query="",this.bindEvents(),this.initRequest()},initRequest:function(){this.data=this.requireInstance("search/widget/suggestion/data",[{input:this.input,sug:this.sug,forumName:this.options.options.forumName,maxCount:this.options.options.maxCount}])},delayRequest:function(){return this.query=this.getQuery(),this.data.delayRequest(this.skipTime,this.query)},bindEvents:function(){if(this.options.searchFixed){var t=this.wrapper.offset().top,e=$(window).scrollTop();this.toggleFlag=t>e,this.fixSize(!0)}$(window).bind("scroll",$.proxy(this.fixSize,this)).bind("resize",$.proxy(this.fixSize,this)),this.input.bind("keyup",$.proxy(this.handleKeyup,this)).bind("keydown",$.proxy(this.handleKeydown,this)).bind("paste",$.proxy(this.handleElseEvents,this)).bind("focusin",$.proxy(this.handleElseEvents,this)).bind("click",$.proxy(this.handleElseEvents,this)).bind("focusout",$.proxy(this.handleFocusout,this)).bind("compositionend",$.proxy(this.handleElseEvents,this)),this.sug.on("mouseenter","li",$.proxy(this.handleMouseenter,this)).on("mouseleave","li",$.proxy(this.handleMouseleave,this)).on("click","li",$.proxy(this.handleFire,this))},handleKeyup:function(t){$.inArray(t.keyCode,[16,17,18,20,37,38,39,40])>=0||13!=t.keyCode&&this.delayRequest()},handleKeydown:function(t){if(!($.inArray(t.keyCode,[16,17,18,20,37,39])>=0))switch(t.keyCode){case 13:return this.handleFire();case 38:return this.prevActive(),!1;case 40:return this.nextActive(),!1;default:this.clearState()}},handleMouseenter:function(t){var e=$(t.currentTarget);this.mouseIn=!0,this.active(e)},handleMouseleave:function(){this.mouseIn=!1},handleFocusout:function(){this.mouseIn||(this.clearState(),this.sug.hide())},handleElseEvents:function(){this.delayRequest()},handleFire:function(){var t=this,e=this.input.getData();if(e&&e.sugUrl){this.clickStats(e);var i=setTimeout(function(){$.tb.location.setHref($.tb.unescapeHTML(e.sugUrl)),t.sug.hide(),clearTimeout(i),i=null},200);return!1}return!0},clickStats:function(t){var e=t.sugType;switch(e){case"game_item":this.clickGameStats(t);break;case"operation_item":this.clickOperationItemStats(t)}},clickGameStats:function(t){$.stats.track("\u641c\u7d22\u6846","\u641c\u7d22\u63d0\u793a\u51fa\u6e38\u620f\u5b9e\u9a8c","","\u70b9\u51fb",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u6e38\u620f"})},clickOperationItemStats:function(t){$.stats.track(t.sugValue,"\u641c\u7d22\u6846\u8fd0\u8425\u914d\u7f6e\u9879\u7edf\u8ba1","","click",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u5e73\u53f0\u5316"})},fixSize:function(t){var e=this;this.fixTime&&clearTimeout(this.fixTime),this.fixTime=setTimeout(function(){var i=e.wrapper.offset().top,s=$(window).scrollTop(),a=e.input,n=a.offset(),r=a.outerHeight()+n.top-1,u=a.outerWidth()-2,o=n.left;if(i>s===e.toggleFlag){if(!t)return}else e.toggleFlag=i>s,e.sug.hide();e.wrapper.hasClass("search_main_fixed")&&(r=a.outerHeight()+10),e.sug.css({width:u,left:o,top:r})},0)},changeState:function(t){var e=t.getData().sugType,i=t.getData().sugUrl,s=t.getData().sugValue;this.input.bindData({sugType:e,sugUrl:i,sugValue:s})},clearState:function(){this.input.bindData({})},active:function(t){var e=t.getData().sugType,i=this.skippedType.slice(0,-1);return $.inArray(e,i)>-1?(this.clearState(),void 0):(this.target=t,this.addOn(t),this.changeState(t),void 0)},nextActive:function(){var t=this.sug.find("ul li"),e=null;if(0!==t.length&&this.sug.is(":visible")){e=this.target&&0!==this.target.next().length?this.target.next():this.sug.find("ul li").eq(0);var i=e.getData().sugType;$.inArray(i,this.skippedType)>-1?(this.target=e,this.nextActive()):this.active(e)}},prevActive:function(){var t=this.sug.find("ul li"),e=null;if(0!==t.length&&this.sug.is(":visible")){e=this.target&&0!==this.target.prev().length?this.target.prev():this.sug.find("ul li").eq(-1);var i=e.getData().sugType;$.inArray(i,this.skippedType)>-1?(this.target=e,this.prevActive()):this.active(e)}},addOn:function(t){t.siblings("li").removeClass("on"),t.addClass("on")},getQuery:function(){return this.input.tbattr("value")},setQuery:function(t){return this.input.tbattr("value",t)}}}),_.Module.define({path:"search/widget/suggestion/data",requires:["search/widget/suggestion/render"],sub:{settings:{url:"/suggestion",isCache:!0,defaultQuery:"DEFAULTQUERY"},initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.forumName=this.options.forumName,this.maxCount=this.options.maxCount||10,this.curCount=0,this.query="",this.dataList=[],this.cache={}},handleResponse:function(t,e){if(0!==e.error)return!1;this.curCount=0,this.query=t;var i=e.query_tips.search_data,s=e.query_match.search_data,a=e.query_tag.search_data,n=e.suggest_game&&e.suggest_game.search_data;this.checkData(i)&&(this.formatData("operation_title"),this.formatOperateData(i)),this.checkData(s)&&(this.checkData(i)&&this.formatData("often_forum_title"),this.formatForumData(s)),this.checkData(n)?(this.formatData("relation_game_title"),this.formatGameData(n)):this.checkData(a)&&(this.formatData("relation_forum_title"),this.formatForumData(a)),!this.checkData(s)&&!this.checkData(a)||this.checkMore(t)||this.formatData("more_title","/f/search/fm?ie=UTF-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),this.renderItems(),this.viewStats()},formatOperateData:function(t){var e,i,s=this.requireInstance("tbui/widget/http_transform",[]);for(e=0;e<t.length&&5>e&&this.checkCount();e++){i=t[e];var a=s.httpTransform(this.replaceAmp(i.forum_url));this.dataList.push({sugType:"operation_item",position:e+1,name:i.fname,desc:i.forum_desc,sugUrl:a}),this.curCount++}this.dataList.push({sugType:"operation_item",str:'<li class="bdfengyun" ><a href = "http://top.baidu.com/?fr=bdtb">\u7531\u767e\u5ea6\u641c\u7d22\u98ce\u4e91\u699c\u63d0\u4f9b</a></li> '})},formatGameData:function(t){var e,i,s=[];for(e=0;e<t.length&&this.checkCount();e++)i=t[e],this.dataList.push({sugType:"game_item",name:i.game_name,title:this.highlightForumName(i.game_name),pic:i.icon_url,desc:i.description,sugUrl:i.link_href}),this.curCount++,s.push(i.game_name);s.length>0&&this.viewGameStats(s)},formatForumData:function(t){var e,i;for(e=0;e<t.length&&this.checkCount();e++)i=t[e],i.fname!==this.forumName&&"me0407"!==i.fname&&(this.dataList.push({sugType:"forum_item",name:i.fname,title:this.highlightForumName(i.fname+"\u5427"),pic:i.fpic,desc:i.forum_desc?i.forum_desc:i.fclass2?"\u6240\u5c5e\u76ee\u5f55\uff1a"+i.fclass1+"&nbsp; "+i.fclass2:"",member:i.member_num,thread:i.thread_num,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(i.fname))}),this.curCount++)},queryData:function(){var t=this.query;this.dataList.push({sugType:"reverse_query",name:t,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(t))})},formatData:function(t,e){var i=this.query;this.dataList.push({sugType:t,name:i,sugUrl:e})},getQuery:function(){return this.input.tbattr("value")},clearSuggestion:function(){this.dataList=[]},checkCount:function(){return this.curCount<this.maxCount},checkData:function(t){return $.isArray(t)&&t.length>0},checkMore:function(t){return!t||/^\s+$/.test(t)||t===this.forumName},replaceAmp:function(t){return t&&t.replace(/\&amp;/g,"&")},formatString:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},highlightForumName:function(t){var e="",i="",s=this.query,a=new RegExp(s.replace(/[\/\\]/g,""),"g");return e=$.tb.escapeHTML(t),i=s?e.replace(a,function(t){return'<em class="highlight">'+t+"</em>"}):e},renderItems:function(){var t="",e=this.requireInstance("search/widget/suggestion/render");this.dataList.length>0&&this.queryData(),t=e.renderSuggestion(this.dataList),""!==t?this.sug.show().find("ul").html(t):this.sug.hide(),this.clearSuggestion()},viewStats:function(){},viewGameStats:function(t){$.stats.track("\u641c\u7d22\u6846","\u641c\u7d22\u63d0\u793a\u51fa\u6e38\u620f\u5b9e\u9a8c","","\u5c55\u73b0",{obj_name:this.query,obj_game_name:t,obj_type:"\u6e38\u620f"})},request:function(t){var e=this;(t===this.forumName||"me0407"===t)&&(t="");var i=""===t?this.settings.defaultQuery:t;this.settings.isCache&&i in this.cache?this.handleResponse(t,this.cache[i]):(this.queryRequest&&this.queryRequest.abort(),this.queryRequest=$.ajax({url:this.settings.url,data:{query:t,ie:"utf-8"},dataType:"json",type:"get",cache:!1,success:function(i){e.responseSuccess(t,i)}}))},delayRequest:function(t,e){var i=this;this.requestTimer&&clearTimeout(this.requestTimer),this.requestTimer=setTimeout(function(){i.request(e),clearTimeout(i.requestTimer),i.requestTimer=null},t)},responseSuccess:function(t,e){if(this.settings.isCache){var i=""===t?this.settings.defaultQuery:t;this.cache[i]=e}this.handleResponse(t,e),this.queryRequest=null}}}),_.Module.define({path:"search/widget/suggestion/render",requires:[],sub:{queryTemplate:'<li class="reserve_query" #{info}></li>',titleTemplate:['<li class="break_title #{special}" #{info}>','<span class="break_tip">#{title}</span>',"</li>"].join(""),forumTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}','<span title="\u4f1a\u5458\u6570" class="forum_member">#{member}</span>','<span title="\u5e16\u5b50\u6570" class="forum_thread">#{thread}</span>',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),gameTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),operationTemplate:["<li #{info}>",'<div class="operation_item item_top#{position}">',"<i></i>",'<div class="operation_title">#{name}</div>','<div class="operation_desc">#{desc}</div>',"</div>","</li>"].join(""),initial:function(){},renderQuery:function(t){var e=$.tb.dataField({sugType:t.sugType,sugValue:t.name,sugUrl:t.sugUrl});return $.extend(t,{info:e}),$.tb.format(this.queryTemplate,{info:e})},renderTitle:function(t){var e="",i="",s=t.name,a=$.tb.dataField({sugType:t.sugType,sugValue:s,sugUrl:t.sugUrl});switch(t.sugType){case"operation_title":e="\u5927\u4f19\u6b63\u5728\u804a";break;case"often_forum_title":e="\u6700\u8fd1\u5e38\u901b\u7684\u5427\uff1a";break;case"relation_forum_title":e='\u4e0e\u201c<em class="highlight">'+s+"</em>\u201d\u6709\u5173\u7684\u5427\uff1a";break;case"relation_game_title":e='\u4e0e\u201c<em class="highlight">'+s+"</em>\u201d\u6709\u5173\u7684\u6e38\u620f\uff1a";break;case"more_title":e='\u5728\u8d34\u5427\u4e2d\u641c\u7d22\u66f4\u591a\u4e0e\u201c<em class="highlight">'+s+"</em>\u201d\u76f8\u5173\u7684\u5427",i="special_title more_title"}return $.tb.format(this.titleTemplate,{info:a,special:i,title:e})},renderForum:function(t){var e=$.tb.dataField({sugType:t.sugType,sugValue:t.name,sugUrl:t.sugUrl});return $.extend(t,{info:e}),$.tb.format(this.forumTemplate,t)},renderGame:function(t){var e=$.tb.dataField({sugType:t.sugType,sugValue:t.name,sugUrl:t.sugUrl+(t.sugUrl.indexOf("?")<0?"?":"&")+"gfr=search_suggestion"});return $.extend(t,{info:e}),$.tb.format(this.gameTemplate,t)},renderOperation:function(t){var e=$.tb.dataField({sugType:t.sugType,sugValue:t.name,sugUrl:t.sugUrl});return $.extend(t,{info:e}),$.tb.format(this.operationTemplate,t)},renderSuggestion:function(t){var e,i="",s=null,a=t.length;for(e=0;a>e;e++)switch(s=t[e],s.sugType){case"reverse_query":i+=this.renderQuery(s);break;case"operation_item":i+=s.str?s.str:this.renderOperation(s);break;case"forum_item":i+=this.renderForum(s);break;case"game_item":i+=this.renderGame(s);break;default:i+=this.renderTitle(s)}return i}}}),_.Module.define({path:"search/widget/suggestion",requires:["search/widget/suggestion/base"],sub:{options:{input:null,maxCount:12,skipTime:50,classes:{expand:"suggestion",expandList:"suggestion_list"}},initial:function(t){this.options=$.extend(this.options,t),this.initSug()},initSug:function(){this.options.input&&this.requireInstance("search/widget/suggestion/base",[this.options])}}});_.Module.define({path:"search/widget/search_handler",sub:{_staticUrl:{no_key:"//tieba.baidu.com/","\u8d34\u5427\u6295\u8bc9":"//tieba.baidu.com/tousu/new","\u5e16\u5427\u6295\u8bc9":"//tieba.baidu.com/tousu/new",tiebatousu:"//tieba.baidu.com/tousu/new","\u8d34\u5427\u6295\u8bc9\u5427":"//tieba.baidu.com/tousu/new","\u8d34\u5427\u6295\u8bc9\u4e2d\u5fc3":"//tieba.baidu.com/tousu/new","\u6295\u8bc9\u4e2d\u5fc3":"//tieba.baidu.com/tousu/new","\u6295\u8bc9":"//tieba.baidu.com/tousu/new","\u8d34\u5427\u4e3e\u62a5":"//tieba.baidu.com/tousu/new","\u77e5\u9053\u6295\u8bc9":"http://tousu.baidu.com/zhidao","\u7a7a\u95f4\u6295\u8bc9":"http://tousu.baidu.com/hi","\u767e\u79d1\u6295\u8bc9":"http://tousu.baidu.com/baike",zhidaotousu:"http://tousu.baidu.com/zhidao",kongjiantousu:"http://tousu.baidu.com/hi",baiketousu:"http://tousu.baidu.com/baike"},_sendStatistics:function(t){$.stats.sendRequest("st_mod=search&search_type="+t)},initial:function(){},toStaticUrl:function(t){var e=t.toLowerCase();return this._staticUrl.hasOwnProperty(e)?($.tb.location.setHref(this._staticUrl[e]),!1):void 0},enterBa:function(t,e){if(""==t)return $.tb.location.setHref(this._staticUrl.no_key),!1;this.toStaticUrl(t);var s=[];if(s=-1!=t.indexOf("\uff1a")?t.split("\uff1a"):t.split(":"),2==s.length){if("\u6807\u7b7e"==s[0])return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1;if(-1!=s[0].indexOf("\u5427\u5185")){var o=s[0].split("\u5427\u5185")[0];if(o)return this._sendStatistics("baneisearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(o))+"&qw="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1}}if(PageData.search_what&&"fromBtn"!=e){if("composite"==PageData.search_what)return this._sendStatistics("compositesearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1;if("forum"==PageData.search_what)return this._sendStatistics("forumsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1}return this._sendStatistics("enterba&from=search",t),$.tb.location.setHref("/f?ie=utf-8&kw="+encodeURIComponent(t)+"&fr=search"),!1},searchPost:function(t){return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("postsearch",t),setTimeout(function(){$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t)))},100),!1},searchPostInBa:function(t,e){var s="/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(e))+"&qw="+encodeURIComponent($.tb.escapeHTML(t));return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("baneisearch",t),setTimeout(function(){$.tb.location.setHref(s)},100),!1},searchPeople:function(t){return this._sendStatistics("peoplesearch",t),$.tb.location.setHref("/f/search/sure?ie=utf-8&only_user=1&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchTag:function(t){return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchForum:function(t){var e="/f/search/fm?ie=UTF-8&";return-1!=t.indexOf("\u6807\u7b7e\uff1a")?(t=t.substr(t.indexOf("\u6807\u7b7e\uff1a")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):-1!=t.indexOf("\u6807\u7b7e:")?(t=t.substr(t.indexOf("\u6807\u7b7e:")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):e=e+"qw="+encodeURIComponent($.tb.escapeHTML(t)),$.tb.location.setHref(e),!1}}});_.Module.define({path:"search/widget/searchDialog",requires:["search/widget/searchHandler"],sub:{_DLG_ID:"tb_header_search_dlg",_options:{defaultType:"post",style:null,forumName:null,page:null},_searchHandler:null,_jq_wrap:null,_jq_input:null,_jq_form:null,initial:function(t){$.extend(this._options,t),this._initOptPage(),this._searchHandler=this.use("search/widget/searchHandler"),this._initDlg()},_initOptPage:function(){null==this._options.page&&(/^\w+:\/\/[^\/]+\/(index\.html?)|(i\/\d+)/.test($.tb.location.getHref())?this._options.page="index":/^\w+:\/\/[^\/]+\/tb\/picture\/(index\.html?)/.test($.tb.location.getHref())?this._options.page="picture_index":"itieba3"==PageData.product&&(this._options.page="itieba"))},_initDlg:function(){var t=this._createDlgHtml();new $.dialog({html:t,title:"\u8bf7\u8f93\u5165\u60a8\u8981\u627e\u7684\u5185\u5bb9",width:482}),this._jq_wrap=$("#"+this._DLG_ID),this._jq_input=this._jq_wrap.find(".j_kw"),this._jq_form=this._jq_wrap.find(".j_form"),this._bindEvents()},_bindEvents:function(){var t=this;t._jq_form.bind("submit",function(){return t.submit(),!1}),t._jq_input.focus()},_formSubmitHandler:function(){var t=this._getSearchType(),e=this._jq_input.val();return this.handleSubmit(t,e)},submit:function(){var t=this.getSearchWord();switch(this._options.defaultType){case"post":this._searchHandler.searchPost(t);break;case"benba":this._searchHandler.searchPostInBa(t,this._options.forumName)}return!1},getSearchWord:function(){var t=this._jq_input.val();return t=t.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")},_getSearchType:function(){var t=CommonSearch.SearchConfig.searchTypes.tieba,e=this._jq_wrap.find("input:checked").tbattr("class"),s=CommonSearch.SearchConfig.radioClasses;for(var i in s)if(s[i]==e){t=CommonSearch.SearchConfig.searchTypes[i];break}return t},_createDlgHtml:function(){var t='<div id="'+this._DLG_ID+'" class="search_dialog_bright"><form name="f1" class="j_form"  action="/f"><input autocomplete="off" size="42" tabindex="1" name="kw" class="j_kw s_ipt tb_header_search_input" maxlength="100" /><span class="s_btn_wr">';return t+="post"===this._options.defaultType?'<input type="submit" value="\u8d34\u5427\u641c\u7d22" class="j_submit s_btn" onmousedown="this.className=\'s_btn s_btn_h\'" onmouseout="this.className=\'s_btn\'" /></span></form>':'<input type="submit" value="\u5427\u5185\u641c\u7d22" class="j_submit s_btn" onmousedown="this.className=\'s_btn s_btn_h\'" onmouseout="this.className=\'s_btn\'" /></span></form>',t+="</div>"}}});_.Module.define({path:"search/widget/search_logic",requires:["search/widget/searchDialog","search/widget/searchHandler","search/widget/suggestion"],sub:{_jq_wrap:null,_jq_input:null,_jq_input_box:null,_jq_form:null,_options:{defaultType:"tieba",style:"",forumName:"",page:null},_tip:null,_searchHandler:null,_switchRadios:{},_radioClasses:{tieba:"jointb",itieba:"authortb",post:"searchtb",benba:"nowtb",tag:"searchtag",forum:"searchforum"},_searchTypes:{tieba:1,itieba:2,post:3,benba:4,tag:5,forum:6},_searchFixed:null,initial:function(e,t){var i=this.requireInstance("tbui/widget/http_transform"),s=$(".j_search_nav").find("a[param=wd]");if(i.httpLinkHover(s),this._jq_wrap=e,this._jq_form=e.find(".j_search_form"),this._jq_input=e.find("#wd2"),this._jq_input_box=e.find(".j_search_input"),this._tip=PageUnit.load("search_input_tip"),this._searchFixed=t.searchFixed,this._searchWrapper=e.find(".search_main"),this._sugOn=t.sugOn,$.extend(this._options,t),this._initOptPage(),this._searchHandler=this.use("search/widget/searchHandler"),this._setSwitchRadios(),this._setDefaultType(),this._setSearchType(this._options.defaultType),this._initPlaceholder(),this._bindEvents(),$.browser.msie&&parseInt($.browser.version)<=7)return!1;if(this._searchScrollFixed(),"1"==this._sugOn){var t={input:this._jq_input_box,forumName:t.forumName,searchFixed:t.searchFixed,fixWrapper:this._searchWrapper};this.use("search/widget/suggestion",t)}else{var t={input:this._jq_input_box,forumName:t.forumName,searchFixed:t.searchFixed,fixWrapper:this._searchWrapper};this.use("search/widget/suggestion",t)}},_setSwitchRadios:function(){var e=this;for(var t in this._searchTypes)this._switchRadios[t]=e._jq_wrap.find(".switch_radios ."+e._radioClasses[t]+":first")},_setDefaultType:function(){var e=$.tb.location.getHref();-1!=e.indexOf("/f/search/fm")?this._options.defaultType="forum":-1!=e.indexOf("/f/search/res")?this._options.defaultType="post":-1!=e.indexOf("/f/search/sure")&&(this._options.defaultType="itieba"),"bright_3"==this._options.style&&(this._options.defaultType="benba")},_getSearchType:function(){var e=null;if("pb"===this._options.product)return e=this._searchTypes.benba;e=this._searchTypes.tieba;for(var t in this._switchRadios){var i=this._switchRadios[t];if(i.tbattr("checked")){e=this._searchTypes[t];break}}return e},_setSearchType:function(e){e in this._switchRadios&&("2"==this._searchTypes[e]&&this._switchRadios.tieba.tbattr("checked",!1),this._switchRadios[e].tbattr("checked",!0))},_bindEvents:function(){var e=this;this._jq_wrap.find("#search_button").on("click",function(){"frs"===e._options.product?$.stats.track("FRS_\u53f3\u4fa7\u4e0a\u65b9\u5c0f\u56fe","PC\u7aef\u5546\u4e1a\u5316\u6e38\u620f\u7edf\u8ba1",e._options.product||"","\u70b9\u51fb",{obj_url:"-",obj_name:"-",obj_type:"\u6e38\u620f"}):"pb"===e._options.product&&$.stats.track("PB_\u53f3\u4fa7\u4e0a\u65b9\u5c0f\u56fe","PC\u7aef\u5546\u4e1a\u5316\u6e38\u620f\u7edf\u8ba1",e._options.product||"","\u70b9\u51fb",{obj_url:"-",obj_name:"-",obj_type:"\u6e38\u620f"})}),this._jq_wrap.find(".j_search_nav a").click(function(){e._changeProduct($(this))}),this._jq_form.submit(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e.submit(),!1}),this._jq_wrap.find(".j_enter_ba").click(function(){return e.submit("fromBtn"),!1}),this._jq_wrap.find(".j_search_post").click(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e._searchPost.call(e),!1}),this._jq_wrap.find(".j_benba_search").click(function(){"pb"==e._options.page&&e.handleSubmit(e._getSearchType(),e.getSearchWord())}),this._jq_input_box.bind("webkitspeechchange",function(){e.submit()}),$.browser.webkit?this._jq_input_box.click(function(){this.select()}):this._jq_input_box.focus(function(){this.select()})},submit:function(e){var t=this.getSearchWord();return"me0407"===t?(this._jq_input_box.blur(),$.dialog.assert("\u6b64\u5427\u6682\u65f6\u4e0d\u80fd\u8bbf\u95ee\u54e6~"),!1):($("#searchtag").tbattr("checked")?this._searchHandler.searchTag(t):this._searchHandler.enterBa(t,e),!1)},handleSubmit:function(e,t){var i=!0;switch(e){case this._searchTypes.tieba:i=this._searchHandler.enterBa(t);break;case this._searchTypes.itieba:i=this._searchHandler.searchPeople(t);break;case this._searchTypes.post:i=this._searchHandler.searchPost(t);break;case this._searchTypes.benba:i=this._searchHandler.searchPostInBa(t,this._options.forumName);break;case this._searchTypes.tag:i=this._searchHandler.searchTag(t);break;case this._searchTypes.forum:i=this._searchHandler.searchForum(t);break;default:i=!0}return i},_initOptPage:function(){null==this._options.page&&(/^\w+:\/\/[^\/]+\/(index\.html?)|(i\/\d+)/.test($.tb.location.getHref())?this._options.page="index":/^\w+:\/\/[^\/]+\/tb\/picture\/(index\.html?)/.test($.tb.location.getHref())?this._options.page="picture_index":"itieba3"==this._options.product&&(this._options.page="itieba"))},_changeProduct:function(e){var t=this.getSearchWord(),i=$.tb.unescapeHTML(e.tbattr("href")),s=$.tb.unescapeHTML(e.tbattr("param"));if($.stats.track(e.text(),"pc\u7aef\u8d34\u5427tab\u9875\u5bfc\u51fa\u7edf\u8ba1",this._options?this._options.product:"","\u70b9\u51fb"),""==t){var a=i.match(/^(\w+:\/\/[^\/]+)/i),r=i.match(/fr=[^&]+/i),_=[],h="";null!=r&&r.length>0&&_.push(r[0]),_.length>0&&(h="/?"+_.join("&")),e.tbattr("href",a&&a[1]+h)}else if(null!=s&&""!=s){if(i.indexOf("www.baidu.com")>=0){var n="fr=tb01000&";$.tb.location.getHref().match("ftype=guide")&&(n="fr=tb01se0&");var o=i.indexOf("fr=");o>-1?e.tbattr("href",i.substring(0,o)+n):e.tbattr("href",i+n)}var c=e.tbattr("ie");t=null!=c&&null!=c.match(/utf-?8/gi)?encodeURIComponent(t):t.replace(/\%/gi,"%25").replace(/&/gi,"%26").replace(/\+/gi,"%2B").replace(/[\ \u3000]/gi,"%20").replace(/\//gi,"%2F").replace(/\#/gi,"%23").replace(/\=/gi,"%3D");var o=i.indexOf(s+"=");o>-1?e.tbattr("href",i.substring(0,o)+s+"="+t):e.tbattr("href",i+s+"="+t)}},_searchPost:function(){var e=this.getSearchWord();if("me0407"===e)return $.dialog.assert("\u6b64\u5427\u6682\u65f6\u4e0d\u80fd\u8bbf\u95ee\u54e6~"),void 0;var t=$.extend({},this._options);t.defaultType="post",""==e?this.requireInstance("search/widget/searchDialog",t):this._searchHandler.searchPost(e)},_initPlaceholder:function(){var e=this;$.inArray(e._options.page,["index","picture_index","itieba"])?"0"==e._tip&&_.Module.use("search/widget/Placeholder",[e._jq_input_box,e._tip,{color:"#bbb","font-size":"13px"}]):e._jq_input.bind("mousedown focus",function(){e._jq_input.val()===e._tip&&(e._jq_input.val(""),e._jq_input_box.val(""))})},_voiceInput:function(){var e=this.getSearchWord(),t=e.indexOf(this._tip);0===t&&(e=e.slice(this._tip.length),this._jq_input.val(e),this._jq_input_box.val(e)),this.submit()},getSearchWord:function(){return this._jq_input_box.val()},isDefaultTip:function(){return this._jq_input_box.val()===this._tip&&this._jq_input_box.hasClass("s_ipt_tip")||""===this._jq_input_box.val()},_searchScrollFixed:function(){if(this._searchFixed){var e=$("#head").find(".search_main"),t=$(".search_main").offset().top,i=$(".app_forum_top_nav").length>0?!0:!1;if(!i){var s=!1;$(window).scroll(function(){setTimeout(function(){var i=$(window).scrollTop();if(i>t){if(s)return;e.addClass("search_main_fixed").hide(),e.fadeIn(100),e.find(".search_form").addClass("search_form_fixed"),e.find(".search_ipt").addClass("search_ipt_fixed"),e.find(".search_btn").addClass("search_btn_fixed"),e.find(".search_btn_enter_ba").addClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").addClass("search_logo_fixed"),e.find("#tb_header_search_form").addClass("j_search_form_fixed"),$("#search_logo_small").addClass("search_logo_fixed"),$("#search_logo_large").hide(),$("#tb_header_search_form").addClass("j_search_form_fixed"),s=!0}else{if(!s)return;$(".senior-search-link").css({visibility:"visible"}),$("#search_baidu_promote").show(),$("#search_button_wrapper").show(),e.removeClass("search_main_fixed"),e.find(".search_form").removeClass("search_form_fixed"),e.find(".search_ipt").removeClass("search_ipt_fixed"),e.find(".search_btn").removeClass("search_btn_fixed"),e.find(".search_btn_enter_ba").removeClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").removeClass("search_logo_fixed"),$("#search_logo_large").show(),e.find("#tb_header_search_form").removeClass("j_search_form_fixed"),s=!1}},1)})}}}}});_.Module.define({path:"tbui/widget/page_router",sub:{routerSpec:{path:/^\/f$/},currentRouter:{path:""},routerRuleKeys:["path","tab","subTab","cat_id","cid","fcid","scid","hcid","httype","hmtype","pn","kw","status","start","end"],initial:function(t){var e=!(!window.history||!window.history.pushState);e&&(this.pagelet=t,this.location=$.tb.location,this.initRouter(),this.bindEvents(),this.initialTitleEvent())},initRouter:function(){this.refreshCurrentRouter()},bindEvents:function(){window.onpopstate=$.proxy(this.handleStateChange,this),this.pagelet.on("router_handle",$.proxy(this.navigate,this))},handleStateChange:function(t){var e=t.state;e&&this.navigate(e)},navigate:function(t){var e=this.getRouter(t.url);this.setRouter(this.currentRouter,e)},setRouter:function(t,e){var a=this.getUrlDiff(t,e);return Bigpipe.dispatchEvent("page_router_changed",e),a.tab?(Bigpipe.broadcast("tab_change",e),this.pushState(e),!1):a.subTab?(Bigpipe.broadcast("sub_tab_change",e),this.pushState(e),!1):a.cat_id?(Bigpipe.broadcast("catalog_change",e),this.pushState(e),!1):a.cid||a.hcid||a.httype||a.hmtype?(Bigpipe.broadcast("page_change",e),"category"===e.tab&&a.cid&&Bigpipe.broadcast("category_cate_changed",e),this.pushState(e),!1):a.fcid||a.scid?(Bigpipe.broadcast("page_change",e),this.pushState(e),!1):a.status||a.start||a.end?(Bigpipe.broadcast("page_change",e),this.pushState(e),!1):a.pn?(Bigpipe.broadcast("page_change",e),this.pushState(e),!1):void 0},getUrlDiff:function(t,e){var a={},i=this.routerRuleKeys;return $.each(i,function(){a[this]=!(t[this]===e[this])}),a},refreshCurrentRouter:function(){var t=this.location.getHref();this.currentRouter=this.getRouter(t)},getRouter:function(t){var e=URI(t),a=URI.parseQuery(e.search());return $.extend({url:t,path:e.path()},a)},pushState:function(t){window.history.pushState(t,"",t.url),this.refreshCurrentRouter()},initialTitleEvent:function(){var t=PageData.forum.name+"\u5427_\u767e\u5ea6\u8d34\u5427",e=PageData.forum.name,a={main:t,album:e+"\u5427\u7684\u56fe\u7247_"+t,good:e+"\u5427\u7684\u7cbe\u54c1\u8d34_"+t,video:e+"\u5427\u7684\u89c6\u9891_"+t,wangju:e+"\u5427\u7684\u5267\u96c6_"+t,hotthread:e+"\u5427\u7684\u70ed\u95e8\u8d34_"+t,group:e+"\u5427\u7684\u7fa4\u7ec4_"+t,"default":t,game:e+"\u5427\u7684\u6e38\u620f_"+t,category:e+"\u5427\u7684\u5206\u7c7b\u770b\u8d34_"+t,deal:e+"\u5427\u7684\u4e8c\u624b_"+t,gathering:e+"\u5427\u7684\u6d3b\u52a8_"+t,tuan:e+"\u5427\u7684\u56e2\u8d2d_"+t,qa:e+"\u5427\u7684\u95ee\u7b54_"+t,schedule:e+"\u5427\u7684\u5b98\u65b9\u65e5\u7a0b_"+t,newDeal:e+"\u5427\u7684\u4e8c\u624b\u53d1\u5e03_"+t};Bigpipe.addEventListener("page_router_changed",function(t){var e=t.tab;e=e||"main",window.document.title=a[e]})}}});_.Module.define({path:"tbui/widget/tbcopy/zero_clipboard",sub:{get:function(){return this.ZeroClipboard},getClient:function(e){return new this.ZeroClipboard(e)},initial:function(){var e=this;!function(t,n){"use strict";var r,a=t,i=a.document,o=a.navigator,l=a.setTimeout,s=a.Number.parseInt||a.parseInt,u=a.Number.parseFloat||a.parseFloat,c=a.Number.isNaN||a.isNaN,f=a.encodeURIComponent,p=a.Math,d=a.Date,h=a.ActiveXObject,y=a.Array.prototype.slice,v=a.Object.keys,g=a.Object.prototype.hasOwnProperty,m=function(){return"function"==typeof a.Object.defineProperty&&function(){try{var e={};return a.Object.defineProperty(e,"y",{value:"z"}),"z"===e.y}catch(t){return!1}}()?a.Object.defineProperty:void 0}(),b=function(e){return y.call(e,0)},w=function(e,t,n){if("function"==typeof t.indexOf)return t.indexOf(e,n);var r,a=t.length;for("undefined"==typeof n?n=0:0>n&&(n=a+n),r=n;a>r;r++)if(g.call(t,r)&&t[r]===e)return r;return-1},C=function(){var e,t,r,a,i,o,l=b(arguments),s=l[0]||{};for(e=1,t=l.length;t>e;e++)if(null!=(r=l[e]))for(a in r)if(g.call(r,a)){if(i=s[a],o=r[a],s===o)continue;o!==n&&(s[a]=o)}return s},x=function(e){var t,n,r,a;if("object"!=typeof e||null==e)t=e;else if("number"==typeof e.length)for(t=[],n=0,r=e.length;r>n;n++)g.call(e,n)&&(t[n]=x(e[n]));else{t={};for(a in e)g.call(e,a)&&(t[a]=x(e[a]))}return t},E=function(e,t){for(var n={},r=0,a=t.length;a>r;r++)t[r]in e&&(n[t[r]]=e[t[r]]);return n},T=function(e,t){var n={};for(var r in e)-1===w(r,t)&&(n[r]=e[r]);return n},j=function(e){if(null==e)return[];if(v)return v(e);var t=[];for(var n in e)g.call(e,n)&&t.push(n);return t},D=function(e){if(e)for(var t in e)g.call(e,t)&&delete e[t];return e},k=function(e,t){t in e&&"function"==typeof m&&m(e,t,{value:e[t],writable:!1,configurable:!0,enumerable:!0})},I=function(e){return function(){var t;return t=e.now?e.now():(new e).getTime()}}(d),O={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,deactivated:null,overdue:null,ready:null},N="11.0.0",z={},L={},_=null,S={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}},F=(function(){var e,t,n,r,a="ZeroClipboard.swf";if(!i.currentScript||!(r=i.currentScript.src)){var o=i.getElementsByTagName("script");if("readyState"in o[0])for(e=o.length;e--&&("interactive"!==o[e].readyState||!(r=o[e].src)););else if("loading"===i.readyState)r=o[o.length-1].src;else{for(e=o.length;e--;){if(n=o[e].src,!n){t=null;break}if(n=n.split("#")[0].split("?")[0],n=n.slice(0,n.lastIndexOf("/")+1),null==t)t=n;else if(t!==n){t=null;break}}null!==t&&(r=t)}}return r&&(r=r.split("#")[0].split("?")[0],a=r.slice(0,r.lastIndexOf("/")+1)+a),a}(),{swfPath:"//tb2.bdstatic.com/tb/img/ZCB_8fd7d9f.swf",trustedDomains:t.location.host?[t.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999}),$=function(e){if("object"==typeof e&&null!==e)for(var t in e)if(g.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))F[t]=e[t];else if(null==O.bridge)if("containerId"===t||"swfObjectId"===t){if(!q(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");F[t]=e[t]}else F[t]=e[t];return"string"==typeof e&&e?g.call(F,e)?F[e]:void 0:x(F)},X=function(){return{browser:E(o,["userAgent","platform","appName"]),flash:T(O,["bridge"]),zeroclipboard:{version:jt.version,config:jt.config()}}},A=function(){return!!(O.disabled||O.outdated||O.unavailable||O.deactivated)},Y=function(e,t){var n,r,a,i={};if("string"==typeof e&&e)a=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&jt.on(n,e[n]);if(a&&a.length){for(n=0,r=a.length;r>n;n++)e=a[n].replace(/^on/,""),i[e]=!0,z[e]||(z[e]=[]),z[e].push(t);if(i.ready&&O.ready&&jt.emit({type:"ready"}),i.error){var o=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=o.length;r>n;n++)if(O[o[n]]===!0){jt.emit({type:"error",name:"flash-"+o[n]});break}}}return jt},B=function(e,t){var n,r,a,i,o;if(0===arguments.length)i=j(z);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&jt.off(n,e[n]);if(i&&i.length)for(n=0,r=i.length;r>n;n++)if(e=i[n].toLowerCase().replace(/^on/,""),o=z[e],o&&o.length)if(t)for(a=w(t,o);-1!==a;)o.splice(a,1),a=w(t,o,a);else o.length=0;return jt},M=function(e){var t;return t="string"==typeof e&&e?x(z[e])||null:x(z)},H=function(e){var t,n,r;return e=G(e),e&&!nt(e)?"ready"===e.type&&O.overdue===!0?jt.emit({type:"error",name:"flash-overdue"}):(t=C({},e),tt.call(this,t),"copy"===e.type&&(r=st(L),n=r.data,_=r.formatMap),n):void 0},P=function(){if("boolean"!=typeof O.ready&&(O.ready=!1),!jt.isFlashUnusable()&&null===O.bridge){var e=F.flashLoadTimeout;"number"==typeof e&&e>=0&&l(function(){"boolean"!=typeof O.deactivated&&(O.deactivated=!0),O.deactivated===!0&&jt.emit({type:"error",name:"flash-deactivated"})},e),O.overdue=!1,ot()}},Z=function(){jt.clearData(),jt.deactivate(),jt.emit("destroy"),lt(),jt.off()},R=function(e,t){var n;if("object"==typeof e&&e&&"undefined"==typeof t)n=e,jt.clearData();else{if("string"!=typeof e||!e)return;n={},n[e]=t}for(var r in n)"string"==typeof r&&r&&g.call(n,r)&&"string"==typeof n[r]&&n[r]&&(L[r]=n[r])},V=function(e){"undefined"==typeof e?(D(L),_=null):"string"==typeof e&&g.call(L,e)&&delete L[e]},K=function(e){if(e&&1===e.nodeType){r&&(vt(r,F.activeClass),r!==e&&vt(r,F.hoverClass)),r=e,yt(e,F.hoverClass);var t=e.getAttribute("title")||F.title;if("string"==typeof t&&t){var n=it(O.bridge);n&&n.setAttribute("title",t)}var a=F.forceHandCursor===!0||"pointer"===mt(e,"cursor");xt(a),Ct()}},U=function(){var e=it(O.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.top="1px"),r&&(vt(r,F.hoverClass),vt(r,F.activeClass),r=null)},q=function(e){return"string"==typeof e&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},G=function(e){var t;if("string"==typeof e&&e?(t=e,e={}):"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(t=e.type),t){C(e,{type:t.toLowerCase(),target:e.target||r||null,relatedTarget:e.relatedTarget||null,currentTarget:O&&O.bridge||null,timeStamp:e.timeStamp||I()||null});var n=S[e.type];return"error"===e.type&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),"ready"===e.type&&C(e,{target:null,version:O.version}),"error"===e.type&&(/^flash-(disabled|outdated|unavailable|deactivated|overdue)$/.test(e.name)&&C(e,{target:null,minimumVersion:N}),/^flash-(outdated|unavailable|deactivated|overdue)$/.test(e.name)&&C(e,{version:O.version})),"copy"===e.type&&(e.clipboardData={setData:jt.setData,clearData:jt.clearData}),"aftercopy"===e.type&&(e=ut(e,_)),e.target&&!e.relatedTarget&&(e.relatedTarget=J(e.target)),e=W(e)}},J=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?i.getElementById(t):null},W=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var t=e.target,r="_mouseover"===e.type&&e.relatedTarget?e.relatedTarget:n,o="_mouseout"===e.type&&e.relatedTarget?e.relatedTarget:n,l=wt(t),s=a.screenLeft||a.screenX||0,u=a.screenTop||a.screenY||0,c=i.body.scrollLeft+i.documentElement.scrollLeft,f=i.body.scrollTop+i.documentElement.scrollTop,p=l.left+("number"==typeof e._stageX?e._stageX:0),d=l.top+("number"==typeof e._stageY?e._stageY:0),h=p-c,y=d-f,v=s+h,g=u+y,m="number"==typeof e.movementX?e.movementX:0,b="number"==typeof e.movementY?e.movementY:0;delete e._stageX,delete e._stageY,C(e,{srcElement:t,fromElement:r,toElement:o,screenX:v,screenY:g,pageX:p,pageY:d,clientX:h,clientY:y,x:h,y:y,movementX:m,movementY:b,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},Q=function(e){var t=e&&"string"==typeof e.type&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},et=function(e,t,n,r){r?l(function(){e.apply(t,n)},0):e.apply(t,n)},tt=function(e){if("object"==typeof e&&e&&e.type){var t=Q(e),n=z["*"]||[],r=z[e.type]||[],i=n.concat(r);if(i&&i.length){var o,l,s,u,c,f=this;for(o=0,l=i.length;l>o;o++)s=i[o],u=f,"string"==typeof s&&"function"==typeof a[s]&&(s=a[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(u=s,s=s.handleEvent),"function"==typeof s&&(c=C({},e),et(s,u,[c],t))}return this}},nt=function(e){var t=e.target||r||null,n="swf"===e._source;switch(delete e._source,e.type){case"error":w(e.name,["flash-disabled","flash-outdated","flash-deactivated","flash-overdue"])&&C(O,{disabled:"flash-disabled"===e.name,outdated:"flash-outdated"===e.name,unavailable:"flash-unavailable"===e.name,deactivated:"flash-deactivated"===e.name,overdue:"flash-overdue"===e.name,ready:!1});break;case"ready":var a=O.deactivated===!0;C(O,{disabled:!1,outdated:!1,unavailable:!1,deactivated:!1,overdue:a,ready:!a});break;case"copy":var i,o,l=e.relatedTarget;!L["text/html"]&&!L["text/plain"]&&l&&(o=l.value||l.outerHTML||l.innerHTML)&&(i=l.value||l.textContent||l.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",i),o!==i&&e.clipboardData.setData("text/html",o)):!L["text/plain"]&&e.target&&(i=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",i));break;case"aftercopy":jt.clearData(),t&&t!==ht()&&t.focus&&t.focus();break;case"_mouseover":jt.activate(t),F.bubbleEvents===!0&&n&&(rt(C({},e,{type:"mouseover"})),rt(C({},e,{type:"mouseenter",bubbles:!1})));break;case"_mouseout":jt.deactivate(),F.bubbleEvents===!0&&n&&(rt(C({},e,{type:"mouseout"})),rt(C({},e,{type:"mouseleave",bubbles:!1})));break;case"_mousedown":yt(t,F.activeClass),F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}));break;case"_mouseup":vt(t,F.activeClass),F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}));break;case"_click":case"_mousemove":F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)?!0:void 0},rt=function(e){if(e&&"string"==typeof e.type&&e){var t,n=e.target||e.srcElement||null,r=n&&n.ownerDocument||i,o={view:r.defaultView||a,canBubble:!0,cancelable:!0,detail:"click"===e.type?1:0,button:"number"==typeof e.which?e.which-1:"number"==typeof e.button?e.button:r.createEvent?0:1},l=C(o,e);n&&(r.createEvent&&n.dispatchEvent?(l=[l.type,l.canBubble,l.cancelable,l.view,l.detail,l.screenX,l.screenY,l.clientX,l.clientY,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.button,l.relatedTarget],t=r.createEvent("MouseEvents"),t.initMouseEvent&&(t.initMouseEvent.apply(t,l),n.dispatchEvent(t))):r.createEventObject&&n.fireEvent&&(t=r.createEventObject(l),n.fireEvent("on"+l.type,t)))}},at=function(){var e=i.createElement("div");return e.id=F.containerId,e.className=F.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+Et(F.zIndex),e},it=function(e){for(var t=e&&e.parentNode;t&&"OBJECT"===t.nodeName&&t.parentNode;)t=t.parentNode;return t||null},ot=function(){var e,t=O.bridge,n=it(t);if(!t){var r=dt(a.location.host,F),o="never"===r?"none":"all",l=ft(F),s=F.swfPath+ct(F.swfPath,F);n=at();var u=i.createElement("div");n.appendChild(u),i.body.appendChild(n);var c=i.createElement("div"),f="activex"===O.pluginType;c.innerHTML='<object id="'+F.swfObjectId+'" name="'+F.swfObjectId+'" width="100%" height="100%" '+(f?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+s+'"')+">"+(f?'<param name="movie" value="'+s+'"/>':"")+'<param name="allowScriptAccess" value="'+r+'"/><param name="allowNetworking" value="'+o+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+l+'"/></object>',t=c.firstChild,c=null,t.ZeroClipboard=jt,n.replaceChild(t,u)}return t||(t=i[F.swfObjectId],t&&(e=t.length)&&(t=t[e-1]),!t&&n&&(t=n.firstChild)),O.bridge=t||null,t},lt=function(){var e=O.bridge;if(e){var t=it(e);t&&("activex"===O.pluginType&&"readyState"in e?(e.style.display="none",function n(){if(4===e.readyState){for(var r in e)"function"==typeof e[r]&&(e[r]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else l(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),O.ready=null,O.bridge=null,O.deactivated=null}},st=function(e){var t={},n={};if("object"==typeof e&&e){for(var r in e)if(r&&g.call(e,r)&&"string"==typeof e[r]&&e[r])switch(r.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[r],n.text=r;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[r],n.html=r;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[r],n.rtf=r}return{data:t,formatMap:n}}},ut=function(e,t){if("object"!=typeof e||!e||"object"!=typeof t||!t)return e;var n={};for(var r in e)if(g.call(e,r)){if("success"!==r&&"data"!==r){n[r]=e[r];continue}n[r]={};var a=e[r];for(var i in a)i&&g.call(a,i)&&g.call(t,i)&&(n[r][t[i]]=a[i])}return n},ct=function(e,t){var n=null==t||t&&t.cacheBust===!0;return n?(-1===e.indexOf("?")?"?":"&")+"noCache="+I():""},ft=function(e){var t,n,r,i,o="",l=[];if(e.trustedDomains&&("string"==typeof e.trustedDomains?i=[e.trustedDomains]:"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(i=e.trustedDomains)),i&&i.length)for(t=0,n=i.length;n>t;t++)if(g.call(i,t)&&i[t]&&"string"==typeof i[t]){if(r=pt(i[t]),!r)continue;if("*"===r){l=[r];break}l.push.apply(l,[r,"//"+r,a.location.protocol+"//"+r])}return l.length&&(o+="trustedOrigins="+f(l.join(","))),e.forceEnhancedClipboard===!0&&(o+=(o?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof e.swfObjectId&&e.swfObjectId&&(o+=(o?"&":"")+"swfObjectId="+f(e.swfObjectId)),o},pt=function(e){if(null==e||""===e)return null;if(e=e.replace(/^\s+|\s+$/g,""),""===e)return null;var t=e.indexOf("//");e=-1===t?e:e.slice(t+2);var n=e.indexOf("/");return e=-1===n?e:-1===t||0===n?null:e.slice(0,n),e&&".swf"===e.slice(-4).toLowerCase()?null:e||null},dt=function(){var e=function(e,t){var n,r,a;if(null!=e&&"*"!==t[0]&&("string"==typeof e&&(e=[e]),"object"==typeof e&&"number"==typeof e.length))for(n=0,r=e.length;r>n;n++)if(g.call(e,n)&&(a=pt(e[n]))){if("*"===a){t.length=0,t.push("*");break}-1===w(a,t)&&t.push(a)}};return function(t,n){var r=pt(n.swfPath);null===r&&(r=t);var a=[];e(n.trustedOrigins,a),e(n.trustedDomains,a);var i=a.length;if(i>0){if(1===i&&"*"===a[0])return"always";if(-1!==w(t,a))return 1===i&&t===r?"sameDomain":"always"}return"never"}}(),ht=function(){try{return i.activeElement}catch(e){return null}},yt=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&"string"==typeof t){var n=(t||"").split(/\s+/);if(1===e.nodeType)if(e.className){for(var r=" "+e.className+" ",a=e.className,i=0,o=n.length;o>i;i++)r.indexOf(" "+n[i]+" ")<0&&(a+=" "+n[i]);e.className=a.replace(/^\s+|\s+$/g,"")}else e.className=t}return e},vt=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if("string"==typeof t&&t){var n=t.split(/\s+/);if(1===e.nodeType&&e.className){for(var r=(" "+e.className+" ").replace(/[\n\t]/g," "),a=0,i=n.length;i>a;a++)r=r.replace(" "+n[a]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}}return e},gt=function(){var e=/\-([a-z])/g,t=function(e,t){return t.toUpperCase()};return function(n){return n.replace(e,t)}}(),mt=function(e,t){var n,r,i;return a.getComputedStyle?n=a.getComputedStyle(e,null).getPropertyValue(t):(r=gt(t),n=e.currentStyle?e.currentStyle[r]:e.style[r]),"cursor"!==t||n&&"auto"!==n||(i=e.tagName.toLowerCase(),"a"!==i)?n:"pointer"},bt=function(){var e,t,n,r=1;return"function"==typeof i.body.getBoundingClientRect&&(e=i.body.getBoundingClientRect(),t=e.right-e.left,n=i.body.offsetWidth,r=p.round(t/n*100)/100),r},wt=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var n,r,o,l=e.getBoundingClientRect();"pageXOffset"in a&&"pageYOffset"in a?(n=a.pageXOffset,r=a.pageYOffset):(o=bt(),n=p.round(i.documentElement.scrollLeft/o),r=p.round(i.documentElement.scrollTop/o));var s=i.documentElement.clientLeft||0,u=i.documentElement.clientTop||0;t.left=l.left+n-s,t.top=l.top+r-u,t.width="width"in l?l.width:l.right-l.left,t.height="height"in l?l.height:l.bottom-l.top}return t},Ct=function(){var e;if(r&&(e=it(O.bridge))){var t=wt(r);C(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+Et(F.zIndex)})}},xt=function(e){O.ready===!0&&(O.bridge&&"function"==typeof O.bridge.setHandCursor?O.bridge.setHandCursor(e):O.ready=!1)},Et=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return"number"!=typeof e||c(e)?"string"==typeof e&&(t=Et(s(e,10))):t=e,"number"==typeof t?t:"auto"},Tt=function(e){function t(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function n(e){return!!e&&(e=e.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||"chrome.plugin"===e.slice(-13))}function r(e){e&&(s=!0,e.version&&(p=t(e.version)),!p&&e.description&&(p=t(e.description)),e.filename&&(f=n(e.filename)))}var a,i,l,s=!1,c=!1,f=!1,p="";if(o.plugins&&o.plugins.length)a=o.plugins["Shockwave Flash"],r(a),o.plugins["Shockwave Flash 2.0"]&&(s=!0,p="2.0.0.11");else if(o.mimeTypes&&o.mimeTypes.length)l=o.mimeTypes["application/x-shockwave-flash"],a=l&&l.enabledPlugin,r(a);else if("undefined"!=typeof e){c=!0;try{i=new e("ShockwaveFlash.ShockwaveFlash.7"),s=!0,p=t(i.GetVariable("$version"))}catch(d){try{i=new e("ShockwaveFlash.ShockwaveFlash.6"),s=!0,p="6.0.21"}catch(h){try{i=new e("ShockwaveFlash.ShockwaveFlash"),s=!0,p=t(i.GetVariable("$version"))}catch(y){c=!1}}}}O.disabled=s!==!0,O.outdated=p&&u(p)<u(N),O.version=p||"0.0.0",O.pluginType=f?"pepper":c?"activex":s?"netscape":"unknown"};Tt(h);var jt=function(){return this instanceof jt?("function"==typeof jt._createClient&&jt._createClient.apply(this,b(arguments)),void 0):new jt};jt.version="2.0.0",k(jt,"version"),jt.config=function(){return $.apply(this,b(arguments))},jt.state=function(){return X.apply(this,b(arguments))},jt.isFlashUnusable=function(){return A.apply(this,b(arguments))},jt.on=function(){return Y.apply(this,b(arguments))},jt.off=function(){return B.apply(this,b(arguments))},jt.handlers=function(){return M.apply(this,b(arguments))},jt.emit=function(){return H.apply(this,b(arguments))},jt.create=function(){return P.apply(this,b(arguments))},jt.destroy=function(){return Z.apply(this,b(arguments))},jt.setData=function(){return R.apply(this,b(arguments))},jt.clearData=function(){return V.apply(this,b(arguments))},jt.activate=function(){return K.apply(this,b(arguments))},jt.deactivate=function(){return U.apply(this,b(arguments))};var Dt=0,kt={},It=0,Ot={},Nt={};C(F,{autoActivate:!0});var zt=function(e){var t=this;t.id=""+Dt++,kt[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),jt.on("*",function(e){return t.emit(e)}),jt.on("destroy",function(){t.destroy()}),jt.create()},Lt=function(e,t){var n,r,a,i={},o=kt[this.id]&&kt[this.id].handlers;if("string"==typeof e&&e)a=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.on(n,e[n]);if(a&&a.length){for(n=0,r=a.length;r>n;n++)e=a[n].replace(/^on/,""),i[e]=!0,o[e]||(o[e]=[]),o[e].push(t);if(i.ready&&O.ready&&this.emit({type:"ready",client:this}),i.error){var l=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=l.length;r>n;n++)if(O[l[n]]){this.emit({type:"error",name:"flash-"+l[n],client:this});break}}}return this},_t=function(e,t){var n,r,a,i,o,l=kt[this.id]&&kt[this.id].handlers;if(0===arguments.length)i=j(l);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.off(n,e[n]);if(i&&i.length)for(n=0,r=i.length;r>n;n++)if(e=i[n].toLowerCase().replace(/^on/,""),o=l[e],o&&o.length)if(t)for(a=w(t,o);-1!==a;)o.splice(a,1),a=w(t,o,a);else o.length=0;return this},St=function(e){var t=null,n=kt[this.id]&&kt[this.id].handlers;return n&&(t="string"==typeof e&&e?n[e]?n[e].slice(0):[]:x(n)),t},Ft=function(e){if(Bt.call(this,e)){"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(e=C({},e));var t=C({},G(e),{client:this});Mt.call(this,t)}return this},$t=function(e){e=Ht(e);for(var t=0;t<e.length;t++)if(g.call(e,t)&&e[t]&&1===e[t].nodeType){e[t].zcClippingId?-1===w(this.id,Ot[e[t].zcClippingId])&&Ot[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+It++,Ot[e[t].zcClippingId]=[this.id],F.autoActivate===!0&&Rt(e[t]));var n=kt[this.id]&&kt[this.id].elements;-1===w(e[t],n)&&n.push(e[t])}return this},Xt=function(e){var t=kt[this.id];if(!t)return this;var n,r=t.elements;e="undefined"==typeof e?r.slice(0):Ht(e);for(var a=e.length;a--;)if(g.call(e,a)&&e[a]&&1===e[a].nodeType){for(n=0;-1!==(n=w(e[a],r,n));)r.splice(n,1);var i=Ot[e[a].zcClippingId];if(i){for(n=0;-1!==(n=w(this.id,i,n));)i.splice(n,1);0===i.length&&(F.autoActivate===!0&&Vt(e[a]),delete e[a].zcClippingId)}}return this},At=function(){var e=kt[this.id];return e&&e.elements?e.elements.slice(0):[]},Yt=function(){this.unclip(),this.off(),delete kt[this.id]},Bt=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=kt[this.id]&&kt[this.id].elements,n=!!t&&t.length>0,r=!e.target||n&&-1!==w(e.target,t),a=e.relatedTarget&&n&&-1!==w(e.relatedTarget,t),i=e.client&&e.client===this;return r||a||i?!0:!1},Mt=function(e){if("object"==typeof e&&e&&e.type){var t=Q(e),n=kt[this.id]&&kt[this.id].handlers["*"]||[],r=kt[this.id]&&kt[this.id].handlers[e.type]||[],i=n.concat(r);if(i&&i.length){var o,l,s,u,c,f=this;for(o=0,l=i.length;l>o;o++)s=i[o],u=f,"string"==typeof s&&"function"==typeof a[s]&&(s=a[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(u=s,s=s.handleEvent),"function"==typeof s&&(c=C({},e),et(s,u,[c],t))}return this}},Ht=function(e){return"string"==typeof e&&(e=[]),"number"!=typeof e.length?[e]:e},Pt=function(e,t,n){return e&&1===e.nodeType?(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),e):e},Zt=function(e,t,n){return e&&1===e.nodeType?(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n),e):e},Rt=function(e){if(e&&1===e.nodeType){var t=function(t){(t||a.event)&&jt.activate(e)};Pt(e,"mouseover",t),Nt[e.zcClippingId]={mouseover:t}}},Vt=function(e){if(e&&1===e.nodeType){var t=Nt[e.zcClippingId];"object"==typeof t&&t&&("function"==typeof t.mouseover&&Zt(e,"mouseover",t.mouseover),delete Nt[e.zcClippingId])}};jt._createClient=function(){zt.apply(this,b(arguments))},jt.prototype.on=function(){return Lt.apply(this,b(arguments))},jt.prototype.off=function(){return _t.apply(this,b(arguments))},jt.prototype.handlers=function(){return St.apply(this,b(arguments))},jt.prototype.emit=function(){return Ft.apply(this,b(arguments))},jt.prototype.clip=function(){return $t.apply(this,b(arguments))},jt.prototype.unclip=function(){return Xt.apply(this,b(arguments))},jt.prototype.elements=function(){return At.apply(this,b(arguments))},jt.prototype.destroy=function(){return Yt.apply(this,b(arguments))},jt.prototype.setText=function(e){return jt.setData("text/plain",e),this},jt.prototype.setHtml=function(e){return jt.setData("text/html",e),this},jt.prototype.setRichText=function(e){return jt.setData("application/rtf",e),this},jt.prototype.setData=function(){return jt.setData.apply(this,b(arguments)),this},jt.prototype.clearData=function(){return jt.clearData.apply(this,b(arguments)),this},jt.prototype.getFlashState=function(){return O},"function"==typeof define&&define.amd?define(function(){return jt}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=jt:e.ZeroClipboard=jt}(function(){return this}())}}}),_.Module.define({path:"tbui/widget/tbcopy",requires:["tbui/widget/tbcopy/zero_clipboard"],sub:{text:"",initial:function(e){var t=$(e.ele),n=e.text,r=this.requireInstance("tbui/widget/tbcopy/zero_clipboard"),a=r.get();this.clip=new a(t),this.setText(n)},add:function(e){var t=$(e);return t.length?(this.clip.clip(t),this):!1},remove:function(e){var t=$(e);return"undefined"==typeof e||t.length?(this.clip.unclip(e),this):!1},elements:function(){return $(this.clip.elements())},setText:function(e){var t=this;return this.clip.off("copy"),this.clip.on("copy",function(n){if("function"==typeof e)t.text=e(n);else{if("string"!=typeof e)return!1;t.text=e}n.clipboardData.setData("text/plain",t.text),t.successCallback?t.successCallback():$.dialog.alert("\u590d\u5236\u6210\u529f\uff01")}),!0},getText:function(){return this.text},getFlashElement:function(){var e=this.clip.getFlashState();return e.bridge},setSuccessCallback:function(e){return this.successCallback=e,!0}}});_.Module.define({path:"entertainment-game/widget/duoku_servers_dialog",requires:["tbui/widget/tbcopy"],sub:{_dialog_tmp:{fail_html:['<div class="comforum_duoku_servers_dialog">','<!--div class="fail_img"></div-->','<div class="duoku_servers_qrcode_wrapper">','<div class="qrcode_content"></div>',"<p>\u626b\u63cf\u4e8c\u7ef4\u7801\u4e0b\u8f7d\u6e38\u620f</p>","</div>",'<div class="qrcode_right_area">',"<p>\u5df2\u88ab#{code_label}\u5149\u4e86\uff0c\u4f46\u53ef\u4ee5\u7ee7\u7eed\u4e0b\u8f7d\u54e6~</p>",'<div class="btns">','<a href="#{button_url}" class="j_duoku_download btn_default btn_middle" target="_blank">',"<span><em>\u7acb\u5373\u4e0b\u8f7d</em></span>","</a>","</div>","</div>","</div>"].join(""),cong_html:['<div class="comforum_duoku_servers_dialog">','<div class="duoku_servers_qrcode_wrapper">','<div class="qrcode_content"></div>',"<p>\u626b\u63cf\u4e8c\u7ef4\u7801\u4e0b\u8f7d\u6e38\u620f</p>","</div>",'<div class="qrcode_right_area">',"<p>\u60a8\u5df2\u7ecf#{code_label}\uff0c\u8d76\u7d27\u4e0b\u8f7d\u6e38\u620f\u5f00\u59cb\u5427</p>",'<p class="duoku_code j_duoku_code">#{code_title}\uff1a<span class="j_duoku_code_value duoku_code_value">#{game_code}</span></p>','<div class="btns">','<button class="j_duoku_copy duoku_copy btn_default btn_middle"><span><em>\u590d\u5236#{code_title}</em></span></button>','<a href="#{button_url}" class="j_duoku_download btn_default btn_middle" target="_blank">',"<span><em>\u7acb\u5373\u4e0b\u8f7d</em></span>","</a>","</div>","</div>","</div>"].join(""),hadcode_html:['<div class="comforum_duoku_servers_dialog">','<div class="duoku_servers_qrcode_wrapper">','<div class="qrcode_content"></div>',"<p>\u626b\u63cf\u4e8c\u7ef4\u7801\u4e0b\u8f7d\u6e38\u620f</p>","</div>",'<div class="qrcode_right_area">',"<p>\u60a8\u5df2\u7ecf#{code_label}\uff0c\u8d76\u5feb\u4e0b\u8f7d\u5427\u3002</p>",'<p class="duoku_code j_duoku_code">#{code_title}\uff1a<span class="j_duoku_code_value duoku_code_value">#{game_code}</span></p>','<div class="btns">','<button class="j_duoku_copy duoku_copy btn_default btn_middle"><span><em>\u590d\u5236#{code_title}</em></span></button>','<a href="#{button_url}" class="j_duoku_download btn_default btn_middle" target="_blank">',"<span><em>\u7acb\u5373\u4e0b\u8f7d</em></span>","</a>","</div>","</div>","</div>"].join("")},initial:function(){},showDialog:function(e){this.game=e.game,this.postTrack=e.postTrack,this.src=e.src,this.tbs=e.tbs,this._getCode()},_getCode:function(){var e=this,o="/game/duoku/applyToPlay",d=this.game,t=d.game_id,a=d.game_name,_=d.kaifu_id;this.postTrack("\u83b7\u53d6\u8d44\u683c",d),d&&$.post(o,{game_id:t,kaifu_id:_,game_name:a,tbs:this.tbs,src:this.src},function(o){var t=o.data&&(o.data.game_code||o.data.gift_code),a=o.no;d.applied&&(a=2),d.code_title=d.check_code?"\u6d4b\u8bd5\u7801":d.gift_code?"\u793c\u5305\u7801":"\u6d4b\u8bd5\u7801",d.code_label=d.check_code?"\u62a2\u5230\u4e86\u6d4b\u8bd5\u8d44\u683c":d.gift_code?"\u9886\u53d6\u4e86\u6e38\u620f\u793c\u5305":"\u62a2\u5230\u4e86\u6d4b\u8bd5\u8d44\u683c",0==a?(e.postTrack("\u62a2\u53f7\u6210\u529f\u6d6e\u5c42\u5c55\u793a",d,{},"view"),e._showDialog("cong_html","\u606d\u559c\u60a8",d,t)):1==a?(d.code_label=d.gift_code?"\u9886":"\u62a2",e.postTrack("\u5931\u8d25\u6d6e\u5c42\u5c55\u793a",d,{},"view"),e._showDialog("fail_html","\u5f88\u9057\u61be... ...",d,t)):2==a?(e.postTrack("\u5df2\u62a2\u8fc7\u53f7\u6d6e\u5c42\u5c55\u793a",d,{},"view"),e._showDialog("hadcode_html","\u60a8\u5df2\u7ecf\u62a2\u8fc7\u55bd~",d,t)):4==a?e.requireInstanceAsync("common/widget/LoginDialog",["","userBar"]):alert("\u670d\u52a1\u5668\u62bd\u98ce")})},_showDialog:function(e,o,d,t){var a=new $.dialog({html:$.tb.format(this._dialog_tmp[e],{button_url:d.button_url,game_name:d.game_name,game_code:t,code_label:d.code_label,code_title:d.code_title}),title:o,width:436,height:156,draggable:!1,closeable:!0});$.JsLoadManager.use("//tb1.bdstatic.com/tb/static-entertainment-game/qrcode_665d0df.js",function(){new window.QRCode($(".comforum_duoku_servers_dialog .qrcode_content")[0],{text:d.download_url,width:128,height:128})}),t&&(a.element.find(".j_duoku_copy, .j_duoku_code").show(),this.tbcopy?this.tbcopy.add(a.element.find(".j_duoku_copy")):this.tbcopy=this.requireInstance("tbui/widget/tbcopy",{ele:a.element.find(".j_duoku_copy")}),this.tbcopy.setText($(".comforum_duoku_servers_dialog .j_duoku_code_value").text()));var _=this;a.element.on("click",".j_duoku_download",function(){_.postTrack("",d,"","download")}),a.element.on("click",".j_duoku_copy",function(){_.postTrack("\u590d\u5236\u6309\u94ae",d)})}}});_.Module.define({path:"entertainment-game/widget/duoku_servers_list",requires:["entertainment-game/widget/duoku_servers_dialog"],sub:{_btn_list_tmp:{get_code:['<li class="j_dsh_game" data-index="#{index}">','<a href="#{thread_url}" target="_blank"><img src="#{icon_url}"></a>','<span class="game_title"><a href="#{thread_url}" target="_blank">#{game_name}</a></span>','<a href="#{get_code_action}" target="_blank" class="get_code_btn">','<div class="#{platform_class} get_code_icon"></div>',"<span>#{apply_text}</span>","</a>","</li>"].join("")},locateMap:{frs:"p0117",pb:"p0118"},initial:function(e){this.redirectUrl=e.redirectUrl,this.$wrapper=$("#duoku_servers_list");var t=this;this._loader().done(function(e){t._render(e.data),t.dialog=t.requireInstance("entertainment-game/widget/duoku_servers_dialog")}),this._bindEvents()},_loader:function(){var e="/game/duoku/getHotGames?timestamp="+(new Date).getTime(),t=$.getJSON(e);return t},_formatRedirectUrl:function(e,t){for(var a=e.split("?"),r=a[0],i=a[1].split("&"),n={},o=[],d=0,_=i.length;_>d;d++){var l=i[d],s=l.split("=")[0],c=l.split("=")[1];n[s]=c}n._t=+new Date,t&&(delete n.client_type,delete n.refer,delete n.url,delete n.url,delete n.fid,delete n.fname,delete n.page,delete n.type,delete n.ie);for(var g in n)n.hasOwnProperty(g)&&n[g]&&o.push(g+"="+n[g]);return["http://",$.tb.location.getHost(),r,"?",o.join("&")].join("")},getRedirectUrl:function(e,t,a,r,i,n){var o=[this._formatRedirectUrl(this.redirectUrl,n),"location=p0012","obj_ref=3000601","obj_id="+i,"obj_name="+encodeURIComponent(r),"type="+a,"tbjump="+encodeURIComponent(e),"loc_param="+t].join("&");return o},_render:function(e){e=e||[],this.games=e,0==this.games.length&&this.$wrapper.hide();var t=this.$wrapper.find(".servers_list_wrapper"),a="",r=e.length;r=r>7?7:r;for(var i,n=0;r>n;n++){var o=e[n];o.qrcode_url=this.getRedirectUrl(o.redirect_url,"qr_code","download",o.game_name,o.game_id,!0),o.button_url=this.getRedirectUrl(o.redirect_url,"button","click",o.game_name,o.game_id),i="android"==o.supported_os.toLowerCase()?"get_code_android":"get_code_iphone",a+=$.tb.format(this._btn_list_tmp.get_code,{game_name:o.game_name,thread_url:o.thread_url,icon_url:o.icon_url,platform_class:i,apply_text:o.applied?"\u5df2\u9886\u53d6":o.not_available?"\u5e93\u5b58\u544a\u6025":o.check_code?"\u83b7\u53d6\u8d44\u683c":o.gift_code?"\u9886\u53d6\u793c\u5305":"-1"==o.download_url?"\u4e86\u89e3\u8be6\u60c5":"\u7acb\u5373\u4e0b\u8f7d",get_code_action:o.applied||o.not_available||o.check_code||o.gift_code?"javascript:;":"-1"==o.download_url?o.thread_url:o.download_url,index:n})}t.html(a)},_bindEvents:function(){var e=this;this.$wrapper.on("click",".get_code_btn",function(t){if("javascript:;"==$(t.currentTarget).tbattr("href"))e._getGameCode(t);else{var a=$(t.currentTarget).closest(".j_dsh_game").tbattr("data-index"),r=e.games[a];e._postTrack("",r,"","download")}}),this.$wrapper.on("click",".servers_detail_link",function(){e._postTrack("\u66f4\u591a\u94fe\u63a5")})},_getGameCode:function(e){var t=this,a=$(e.currentTarget).closest(".j_dsh_game").tbattr("data-index"),r=this.games[a];return t.dialog.showDialog({tbs:PageData.tbs,game:r,postTrack:$.proxy(t._postTrack,t),src:"list"}),!1},_postTrack:function(e,t,a,r){e||(e=this.locateMap[PageData.product]),"undefined"==typeof r&&(r="click"),a=a||{},a=$.extend({obj_ref:3000603},a),t&&(a=$.extend({obj_name:t.game_name,obj_game_id:t.game_id},a)),$.stats.track(e,"mg_pioneerba","",r,a)}}});_.Module.define({path:"poster/pagelet/rich_poster",sub:{initial:function(){}}});_.Module.define({path:"common/widget/footer",sub:{initial:function(){this._handleEvents()},_handleEvents:function(){var i=$("#btnFroceToPad");i.bind("click",function(){$.cookie("tb_device",null);var i=window.location.href.toString();-1!==i.indexOf("kw")&&-1===i.indexOf("ie=utf-8")&&(i+=-1!==i.indexOf("?")?"&ie=utf-8":"?ie=utf-8"),$.tb.location.setHref(i)})}}});_.Module.define({path:"tbui/widget/LoginDialog",sub:{_config:{},initial:function(){!function(i){var o="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),s="https://passport";i.JsLoadManager.use([s+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(o/6e4)],function(){if(i.stats.track("\u8d34\u5427\u81ea\u6709\u767b\u5f55\u7edf\u8ba1","\u767b\u5f55\u6846\u6253\u5f00","","view"),i(".login-wrap").length>0)return i(".login-wrap").show(),void 0;var o='<div class="login-wrap"><div class="login-content-wrap"><div class="login-title"><div class="login-title-logo"></div>\u5c1a\u672a\u767b\u5f55\u767e\u5ea6\u5e10\u53f7<div class="login-title-close"></div></div><div class="login-way-change"><div class="login-qcode active">\u626b\u7801\u767b\u5f55</div><div class="login-username">\u5e10\u6237\u767b\u5f55</div></div><div id="login-new"></div><div id="login-qcode-wrap"><div id="login-new-qcode"></div><div class="login-qcode-tieba-word">\u6253\u5f00\u6700\u65b0<span>\u624b\u673a\u8d34\u5427-\u6211\u7684</span>\u626b\u4e00\u626b\u767b\u5f55</div><div class="login-qcode-safe-word">\u767e\u5ea6\u6280\u672f\u52a0\u5bc6\uff0c\u4fdd\u969c\u60a8\u7684\u9690\u79c1\u5b89\u5168</div></div></div></div>';i("body").append(o),passport.use("login",{tangram:!0},function(o){var s=new o.passport.login({product:"tb",loginType:1,defaultCss:!1,loginMerge:!0,hasRegUrl:!0,autosuggest:!0,hasPlaceholder:!0,sms:!0,u:"",isPhone:!1,safeFlag:0,qrcode:0,staticPage:i.tb.location.getProtocol()+"//"+i.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",charset:"UTF-8",registerLink:"https://passport.baidu.com/v2/?reg&tpl=tb&u=//tieba.baidu.com"});s.on("loginSuccess",function(o){o.returnValue=!1,i.tb.location.reload()}),s.render("login-new"),i(".pass-sms-btn").click(function(){i(".login-way-change").hide(),i("#login-qcode-wrap").hide(),i(".pass-phoenix-list").hide()}),i(".pass-sms-link-back").click(function(){i(".login-way-change").show(),i(".pass-phoenix-list").show(),i("#login-qcode-wrap").hide(),i("#login-new").show()}),i(".login-qcode").click(function(){i("#login-new").hide(),i("#login-qcode-wrap").show(),i(".login-username").removeClass("active"),i(this).addClass("active"),i.stats.track("\u8d34\u5427\u81ea\u6709\u767b\u5f55\u7edf\u8ba1","\u4e8c\u7ef4\u7801\u767b\u5f55\u5207\u6362","","click")}),i(".login-username").click(function(){i("#login-new").show(),i("#login-qcode-wrap").hide(),i(".login-qcode").removeClass("active"),i(this).addClass("active"),i.stats.track("\u8d34\u5427\u81ea\u6709\u767b\u5f55\u7edf\u8ba1","\u7528\u6237\u540d\u767b\u5f55\u5207\u6362","","click")}),i(".login-title-close").click(function(){i(".login-wrap").hide(),i.stats.track("\u8d34\u5427\u81ea\u6709\u767b\u5f55\u7edf\u8ba1","\u767b\u5f55\u6846\u5173\u95ed","","click")})}),passport.use("loginWLtoPC",{tangram:!1},function(o){var s=new o.passport.loginWLtoPC({product:"tb",sms:!1,u:"https://passport.baidu.com",safeFlag:0,staticPage:i.tb.location.getProtocol()+"//"+i.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",onLoginSuccess:function(o){o.returnValue=!1,i.tb.location.reload()}});s.render("login-new-qcode")})},!0,"utf-8")}(window.jQuery)}}});_.Module.define({path:"encourage-payment/widget/tdou_open_type",sub:{openTypeList:{1001001e3:"dialog",2000118:"dialog"},initial:function(){this.normalType="dialog"},getOpenType:function(e){var i=this.openTypeList[e]||this.normalType;return i}}});_.Module.define({path:"user/widget/user_api",sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSuperMemberShipOf:function(e){return 2==this.getUniversalMemberLevelOf(e)},checkOverdueSuperMembershipOf:function(e){return 2===+$.getPageData("mParr_props.level.props_id",0,e)&&1e3*$.getPageData("mParr_props.level.end_time",0,e)<+new Date},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"user/widget/icons/icons_card",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(o){var i=this;i._option=$.extend(!0,{},i._default_option,o),this._buildCard()},_buildCard:function(){var o=this._option,i=this._genericTpl(),t=o.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(o.content),t.append(this._j_card),delete o.card_css.height,this._j_card.css(o.card_css),o.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===o.arrow_pos.left&&(this._arrow_left=o.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(o.arrow_pos),o.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),o.auto_positon&&this._autoPosition()},_autoPosition:function(){var o=this._option,i={},t=$(window).height(),e=$(window).width(),n=($(document).scrollLeft(),$(document).scrollTop()),_=(o.event_target.innerWidth(),o.event_target.innerHeight()),a="",s={x:o.event_target.offset().left-o.card_css.width/2+o.event_target.outerWidth(!0)/2,y:o.event_target.offset().top-o.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=s.x,i.top=s.y;var c=o.arrow_pos.left||this._arrow_left,r=15,l=e;e<$(document).width()&&(l=$(document).width());var d=l-(o.card_css.width+r);i.left<r?(c+=i.left-r,i.left=r):i.left>d&&(c+=i.left-d,i.left=d),i.top<n?(a="up",i.top+=_+(s.height||0),i.top-=o.offset.y):(i.top+=i.top+_>n+t?-_-(s.height||0):0,a="down",i.top+=o.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+a).css({left:c}),this._j_card.css(i)},_genericTpl:function(){var o=this._option.attr,i=this._option.arrow_dir,t=['<div class="icon_card_wrap" '+o+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return t},showCard:function(o){var i=this;i._close_timer&&clearTimeout(i._close_timer),o&&"delayShow"==o.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},o.time)):i._showCardDo()},closeCard:function(o){var i=this;i._open_timer&&clearTimeout(i._open_timer),o&&"delayClose"==o.type?i._close_timer=setTimeout(function(){i._closeCardDo()},o.time):i._closeCardDo()},hideCard:function(o){var i=this;i._open_timer&&clearTimeout(i._open_timer),o&&"delayHide"==o.type?i._close_timer=setTimeout(function(){i._hideCardDo()},o.time):i._hideCardDo()},_showCardDo:function(){var o=this;o._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var o=this;this._j_card&&!this._is_show&&o._j_card.remove()},_hideCardDo:function(){var o=this;this._j_card&&!this._is_show&&o._j_card.css({visibility:"hidden"})},setContent:function(o){var i=this._option;if(null!==this._j_card){var t=this._j_card.find(".j_content");t.html(o),i.card_css.height=t.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}}),_.Module.define({requires:["user/widget/icons/icons_book_common"],path:"user/widget/icons/icons_book_view",sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96c6\u9f5032\u4e2a\u56fd\u65d7\u5370\u8bb0\u5956\u52b1\u3010\u8d34\u5427\u4e16\u754c\u676f\u3011\u5370\u8bb0",102:"\u96c6\u9f5012\u4e2a\u661f\u5ea7\u5370\u8bb0\u53ef\u4ee5\u83b7\u5f9712\u4e2a\u9ec4\u91d1\u7248\u661f\u5ea7\u5370\u8bb0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),e=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),n="",_="",a=0;for(var s in o)a++;var c=0;for(var s in o){var r={index:c,category_id:s,title:o[s].name,separator_cls:c==a-1?"":"space"};c++,n+=$.tb.format(t,r),_+=$.tb.format(e,r)}var l={tabHead:n,tabContent:_},d=i._getTabPanelTpl();return $.tb.format(d,l)},getTabContent:function(o,i,t){var e="",n="",_=this,a=0,s=0;if(o=o||{},o.normal&&!o.advanced){var c=o.normal||[],r=c.length;return a=5,s=1>=r/50?10:r%a==0?Math.floor(r/a):Math.floor(r/a)+1,e+=_._getPositionIconListHtml(c,s,i,t),n=_._getCommIconWrap(null,a,s,e),_.tabIconsContentCongfig.comm={row:a,col:10,total_col:s},n}if(o.advanced&&o.advanced){var c=o.normal||[],l=o.advanced||[],r=c.length,d=l.length,u="";return a=2,s=1>=r/20?10:r%a==0?Math.floor(r/a):Math.floor(r/a)+1,e+=_._getPositionIconListHtml(c,s,i,t),n=_._getCommIconWrap(null,a,s,e),_.tabIconsContentCongfig.comm={row:a,col:10,total_col:s},n+=_._getDownArrowHtml(),s=1>=d/20?10:r%2==0?Math.floor(d/2):Math.floor(d/2)+1,u+=_._getPositionIconListHtml(l,s,null,t),n+=_._getAdvancedIconWrap(null,a,s,u,t),_.tabIconsContentCongfig.adv={row:a,col:10,total_col:s},n}return n},_getCommIconWrap:function(o,i,t,e){var n={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:e,total_col:t},_=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(_,n)},_getAdvancedIconWrap:function(o,i,t,e,n){var _=this,a={title:_._collect_icon_title[n],arrow_visiblity:t>10?"visible":"hidden",icon_list:e,total_col:t},s=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(s,a)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,e){for(var n="",_=this,a=!1,s=o.length,c=0,r=0,l=0;s>l;l++){c=Math.floor(l/i),r=l%i;var d=55*c,u=55*r;a=t&&t==o[l].name?!0:!1;var b="";b=0==o[l].is_advanced?_._getCommonIconTpl(o[l],d,u,e,a):_._getAdvIconTpl(o[l],d,u,e),n+=b}return n},_getCommonIconTpl:function(o,i,t,e,n){var _=this,a=o.sprite[o.value].split(","),s="//tb1.bdstatic.com/tb/cms/com/icon/"+e+"_"+_.spriteImgSize+".png",c=50,r=a[0],l=a[1],d=0,u=l*c,b="background: url("+s+"?stamp="+r+") no-repeat -"+u+"px -"+d+"px;",v={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:n?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};_._judgeCommIconInSlot(o)&&(v.selected_cls="icon_selected");var p=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(p,v)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,e={};for(var n in e){if("1"==n&&$.isEmptyObject(e[n])){var _=this._getOldIconinfoInSlot();if(t==_)return!0}if(e[n].name==t){i.common=this.requireInstance("user/widget/icons/icons_book_common");var a=i.common.isShowDurationIcon(o);return a?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,e){var n=this,_=o.sprite[o.value].split(","),a=50,s=_[0],c=_[1],r=2*a,r=0,l=c*a,d="//tb1.bdstatic.com/tb/cms/com/icon/"+e+"_"+n.spriteImgSize+".png",u="background: url("+d+"?stamp="+s+") no-repeat -"+l+"px -"+r+"px;",b=o.is_collected,v={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:u},p=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(p,v)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var e=0;e<o.length;e++)if(!o[e].in_use){t=!0;break}t=12==e&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}}),_.Module.define({requires:["user/widget/icons/icons_book_common","user/widget/icons/icons_book_messagebox"],path:"user/widget/icons/icons_book_tip",sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,spriteImgSize:36,initial:function(o){var i=this;i.common=this.requireInstance("user/widget/icons/icons_book_common"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var t=this,e=$("#icon_book_tip");0==e.length&&$(".icon_card_wrap").append(this._getWrapTpl()),e=$("#icon_book_tip"),t._setContent(o);var n=$(".j_icon_book_tip .j_tip_up_arrow"),a=i.position(),s=a.top,c=a.left-5,r=i.parents(".icon_view"),l=r.position(),d=parseInt(l.left)+15,u=s+106;i.parents(".collect_wrap").length>0&&(u+=146),e.css({display:"block",visibility:"visible",top:u+"px",left:d+"px","z-index":2e4});var b=parseInt(c)+25;n.css({left:b+"px"}),t._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html("\u6d88\u8017"+o.icon_info.price+"T\u8c46"),t._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,e=0,n=PageData.user.Parr_scores;n&&(e=n.scores_other+n.scores_money);var a=-1;if(a=t._icon_data.price?t._icon_data.price:t._icon_data.icon_info.price,a>0&&0>e-a&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(t._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?t._replaceIcon4FirstSlot(o):t._replaceIcon4OtherSlot(o);else if(i){var s=$("#j_icon_book_action_btn em");s.length>0&&s.html("\u8d2d\u4e70\u4e2d"),t._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox"));var t=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,t,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,t={ie:"utf-8"};t.tbs=PageData.tbs,t.icon_name=o.icon_id,t.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data;i._refreshAfterReplace(t.icon_info)}else o&&2270028===o.no?(i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox")),i._msgbox.hasNotEnoughTdou()):o&&2380009===o.no?$.dialog.alert("\u540c\u540dicon\u53ea\u80fd\u4f69\u6234\u4e00\u4e2a\uff01"):$.dialog.alert("\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5\uff01")})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.requireInstance("user/widget/icons/icons_book_messagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox"));var t=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,t,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,t={ie:"utf-8"};t.tbs=PageData.tbs,t.icon_name=o.icon_id,t.level=o.value,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data;parr=PageData.user.Parr_scores,parr.scores_fetch=t.scores_fetch||0,parr.scores_money=t.scores_money||0,parr.scores_other=t.scores_other||0,parr.scores_total=t.scores_total,$(".j_userinfo_scores_num").html(parr.scores_money+parr.scores_other);for(var e=$(".tab_body_item_active .icon_view .icon_box_place"),n=0;n<e.length;n++){var _=$(e[n]);if(_.tbattr("data-id")==t.icon_name){_.removeClass("icon_not_use"),_.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip();break}}}else o&&2270028===o.no&&(i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox")),i._msgbox.hasNotEnoughTdou())})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8c46\u4e0d\u8db3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503c</em></span></a>',"</div>"].join("");return o},_getTpl:function(o){var i=this,t=o.icon_info,e=t.sprite[t.value].split(","),n=50,_=e[0],a=e[1],s=0,c=a*n,r="//tb1.bdstatic.com/tb/cms/com/icon/"+t.category_id+"_"+i.spriteImgSize+".png",l=" background:url("+r+"?stamp="+_+") no-repeat -"+c+"px -"+s+"px;",d="",u=i.common.getIconExpired(t);u>-1&&(d='<span style="margin-left: 20px;">\u5269\u4f59\u65f6\u95f4\uff1a'+u+"\u5929</span>");var b=t.title,v=t.intro,p=t.intro_url,h={background_img:l,desc_title:b+d||"\u5370\u8bb0",desc_detail:v||"",desc_link:p||"//tieba.baidu.com/",btn_value:o.in_use?"\u66ff\u6362":"\u8d2d\u4e70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==t.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(h.button_display="none"),"none"==h.button_display&&(h.in_use_display="display",h.in_use_text="\u4f7f\u7528\u4e2d",h.price_info_display="none"),0==o.in_use&&0==t.price&&(h.in_use_text="\u6d3b\u52a8\u83b7\u53d6");var m=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8be6\u60c5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(m,h)},_judgeCommIconInSlot:function(o){var i={};for(var t in i){var e=this.common.isShowDurationIcon(i[t]);if(i[t].name==o&&e)return!0}return!1}}}),_.Module.define({requires:["user/widget/icons/icons_book_common","user/widget/icons/icons_card"],path:"user/widget/icons/icons_book_messagebox",sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.requireInstance("user/widget/icons/icons_book_common")},showBox:function(o,i){var t=this;t._showBox(i),t.generatorBuySlot(o),t._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,t=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(t),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,t,e){var n=this;setTimeout(function(){e.closeTip()},0),n._showBox(i);var _=n._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(_),$(".icon_book_msgbox .ui_btn").click(function(){t.call(e,o)})},showBuyIconBox:function(o,i,t,e){var n=this;setTimeout(function(){e.closeTip()},0),n._showBox(i);var a=n._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(a),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,a=PageData.user.Parr_scores;if(a&&(i=a.scores_other+a.scores_money),i-o.icon_info.price<0){var s=n._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(s),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}t.call(e,o.icon_info,function(){var o=n._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,t=0,e=PageData.user.Parr_scores;e&&(t=e.scores_other+e.scores_money+e.scores_fetch);var n=-1;if(n=o.price?o.price:o.icon_info.price,n>0&&0>t-n){var a=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(a),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}var s={ie:"utf-8",slot_no:o.add_slot_no||1};s.tbs=PageData.tbs,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:s,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data,e=i._addSuccess();$(".icon_book_msgbox_body").html(e),i._refreshSlotList(),t.scores_other||0,t.scores_money||0,i._updateTdouAccount(t.scores_other,t.scores_money,t.scores_fetch)}else if(o&&2270028===o.no)i.hasNotEnoughTdou();else{var n='<div class="icon_book_error">\u672a\u77e5\u9519\u8bef<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65b0</a></div>';$(".icon_book_msgbox_body").html(n),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,t){var e=PageData.user.Parr_scores;e&&(e.scores_other=o,e.scores_money=i,e.scores_fetch=t,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var t=i._getTpl(),e={content:t,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.requireInstance("user/widget/icons/icons_card",e),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,t='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70b9\u51fb\u6dfb\u52a0\u5370\u8bb0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(t),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606d\u559c\u60a8\u83b7\u5f97\u4e86\u4e00\u679a\u5370\u8bb0\u63d2\u69fd</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606d\u559c\u60a8\u83b7\u5f97\u4e86\u4e00\u679a\u65b0\u5370\u8bb0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5feb\u53bb\u56fe\u9274\u770b\u770b\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8bb0\u66ff\u6362\u6210\u529f</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786e\u5b9a</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8c46\u4e0d\u8db3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7acb\u5373\u5145\u503c</em></span></a>',"</div>"].join("");return o},_getBuySlotTpl:function(o){var i={price:o.price},t=['<div class="icon_msgbox_title">\u9700\u8981\u6d88\u8017#{price}T\u8c46\u5f00\u542f\u5370\u8bb0\u63d2\u69fd</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5f00\u542f\u540e\u514d\u8d39\u66f4\u6362\u5370\u8bb0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5f00\u542f</em></span></a>',"</div>"].join("");return $.tb.format(t,i)},_getReplaceFirstSlotTipTpl:function(o){var i=this,t=o.old_icon_info,e=o.icon_info,n=this.common.isShowDurationIcon(t),_=n?i._getIconBackground(t):"",a=i._getIconBackground(e),s={old_background:_,background:a},c=['<div class="icon_msgbox_title">\u70b9\u51fb\u66ff\u6362\u5f53\u524d\u5370\u8bb0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66ff\u6362</em></span></a>',"</div>"].join("");return $.tb.format(c,s)},_getIconBackground:function(o){var i=0,t=0,e="//tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var n=o.sprite[o.value].split(","),_=50,a=n[0],s=n[1];i=0,t=s*_;var c="background: url("+e+"?stamp="+a+") no-repeat -"+t+"px -"+i+"px;";return c}return""},_getBuyIconTpl:function(o){var i=this,t=i._getIconBackground(o.icon_info),e={price:o.icon_info.price,background:t},n=['<div class="icon_msgbox_title">\u9700\u8981\u6d88\u801710000T\u8c46\u8d2d\u4e70\u8be5\u5370\u8bb0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8d2d\u4e70</em></span>","</a>","</div>"].join("");return $.tb.format(n,e)},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var t=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(t),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,t=$(".icon_wrap .icon_slot_refresh");t&&(t=t.parent()),i._showBox(t);var e=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var n=o.getControl();n&&n.closeIconBook()}}}}),_.Module.define({requires:["user/widget/icons/icons_book_common"],path:"user/widget/icons/icons_book_get_icon",sub:{_dialog:null,initial:function(){this.common=this.requireInstance("user/widget/icons/icons_book_common")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},t=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),t._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return i._handleError(),void 0;var t={ie:"utf-8"};t.tbs=PageData.tbs,t.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data;if(!t.icon_info)return i._handleError(),void 0;i.showOneIcon(t.icon_info)}else o&&2380009===o.no?$.dialog.alert("\u540c\u540dicon\u53ea\u80fd\u4f69\u6234\u4e00\u4e2a\uff01"):i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,t=i._getOneIconTpl(o);i._init(t),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),t={styleBg:i,iconTitle:o.title},e=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606d\u559c\u4f60\u83b7\u5f97\u4e86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5feb\u53bb\u770b\u770b\u6211\u7684\u56fe\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(e,t)}},showDurationIcon:function(o,i){var t=[];t.push(o),this.showIconList(t,i,"duration")},showIconList:function(o,i,t){var e=this,n={hide_btn:!1,close_callback:function(){},close_time:0};n=$.extend(n,i);var _=e._getIconListTpl(o,n.hide_btn,t);e._init(_),e.show(),n.close_time&&parseInt(n.close_time)>0&&setTimeout(function(){e._dialog.close()},parseInt(n.close_time)),n.close_callback&&"function"==typeof n.close_callback&&e._dialog.onclose(function(){n.close_callback()})},_getIconListTpl:function(o,i,t){var e=this,n=PageData.user.portrait;if(o||$.isArray(o)){for(var _=[],a=[],s="",c=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5feb\u53bb\u770b\u770b\u6211\u7684\u56fe\u9274</em></span>","</a>","</div>"].join(""),r=0;r<o.length;r++){var l=e._getIconFormatInfo(o[r],o.length);_.push(l.iconTitle),a.push(l.iconTpl)}if(_=_.join(","),a=a.join(""),t&&"duration"==t){var d=this.common.getIconExpired(o[0]);d>-1&&(s="<span>\u6709\u6548\u5929\u6570\uff1a"+d+"</span><br>")}var u=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606d\u559c\u4f60\u83b7\u5f97\u4e86'+_+"</div>",'<div class="icon_msgbox_get_icon clearfix">',a,"</div>",c,'<p class="icon_book_go_home">',s,'<a href="/home/main?id='+n+'&fr=icon" target="_blank">\u53bb\u6211\u7684\u4e2a\u4eba\u4e2d\u5fc3\u67e5\u770b>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return u}},_getIconFormatInfo:function(o,i){var t=this._getIconStyle(o),e={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+t+'"></div>',styleBg:t,iconTitle:o.title};return e},_getIconStyle:function(o){var i=0,t=0,e="//tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",n=o.sprite[o.value].split(","),_=50,a=n[0],s=n[1];i=2*_,t=s*_;var c="background: url("+e+"?stamp="+a+") no-repeat -"+t+"px -"+i+"px;";return c},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672a\u77e5\u9519\u8bef</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65b0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}}),_.Module.define({requires:["user/widget/icons/icons_book_view","user/widget/icons/icons_book_messagebox","user/widget/icons/icons_card","user/widget/icons/icons_book_tip"],path:"user/widget/icons/icons_book_control",sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.requireInstance("user/widget/icons/icons_book_view");var i=PageData.category_info,t=i.category_list||[{category_id:"101",category_name:"\u8db3\u7403"},{category_id:"102",category_name:"\u661f\u5ea7"},{category_id:"104",category_name:"\u5176\u4ed6"}];o.defaultCategoryId=o._getDefaultCategoryId(i.default_category),o.bindIconBookHookEvents(t)},bindIconBookHookEvents:function(o){var i=this;i._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){i.__timeoutId&&clearTimeout(i.__timeoutId),i.closeAllCard(),i._icon_user_action="buy_slot",i._target_ele=$(this),i._selected_icon_name="";var o=$(".j_icon_slot").length;return i._slot_no=1,i.buySlot({add_slot_no:o+1,price:i._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),i._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return i.__timeoutId&&clearTimeout(i.__timeoutId),i.__timeoutId=setTimeout(function(){i._messagebox&&i._messagebox.hideBox()
},200),!1}),i._wrap.delegate(".j_icon_slot","click",function(t){i.closeAllCard(),i._setIconRefresh($(this)),i._icon_user_action="replace_icon",i._target_ele=$(this);var e=$(this).tbattr("data-slot"),n=$(this).tbattr("data-name");i._selected_icon_name=n,i._slot_no=e;var _="",a={};for(var s in a)a[s].name==n&&(_=a[s].category_id);i.initIconBook({slot_no:e,category_info:o,icon_id:n,action:"replace_icon",category_id:_},$(this)),t.preventDefault()}),i._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),i.closeAllCard(),i._selected_icon_name="",i._setIconRefresh($(this)),i._icon_user_action="buy_icon",i._target_ele=$(this);var e=$(this).tbattr("data-slot");i._slot_no=e,i.initIconBook({slot_no:e,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),i._wrap.delegate(".j_icon_slot","hover",function(o){var i=$(this);if(!i.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),e=($(this).tbattr("data-slot"),{});if(e){var n=null;for(var _ in e)if(e[_].name==t){n=e[_];break}if(n&&n["level_"+n.value]){var a=n["level_"+n.value],s="url("+a.icon_1+") no-repeat",c=o||event;if("mouseenter"==c.type){var r={background:s},l=i.css("background");l||(l=i[0].style.background),i.data({bg:l}),i.css(r),i.addClass("icon_slot_hover"),i.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=i.data("bg"),r={background:l};i.css(r),i.removeClass("icon_slot_hover"),i.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,i){var t=this;t._messagebox||(t._messagebox=t.requireInstance("user/widget/icons/icons_book_messagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,i)},initIconBook:function(o,i){var t=this,e=o.category_info;t.closeIconBook();var n=t._view.getTabItem(e),_={content:n,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.requireInstance("user/widget/icons/icons_card",_),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var a=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(a,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId))},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var i=$(this).index();o._showTab(i),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,i){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),i=i||t._selected_icon_name,t._loadTabContent(o,i),t._current_tab_index=i},_loadTabContent:function(o,i){var t=this,e='<div class="icon_book_error">\u6b63\u5728\u52aa\u529b\u52a0\u8f7d\uff0c\u8bf7\u7a0d\u540e...</div>';$("#tab_content_"+o).html(e);var n={ie:"utf-8"},_=$("#tab_head_"+o).tbattr("data-categoryId");n.tbs=PageData.tbs,n.category_id=_,t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:n,dataType:"json"}).success(function(e){if(e&&0===e.no){var n=e.data,a=n.icon_info,s=t._view.getTabContent(a,i,_);$("#tab_content_"+o).html(s),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=n.icon_info}else{var s='<div class="icon_book_error">\u672a\u77e5\u9519\u8bef<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65b0</a></div>';$("#tab_content_"+o).html(s),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.requireInstance("user/widget/icons/icons_book_tip",[o]));var i=$("#icon_book_wrap");i.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),i.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var i=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),e=$(this).tbattr("data-level"),n=$(this).hasClass("icon_not_use"),_=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),a=o._icon_info["category_"+_],s=null,c=null;if(a){a=a.normal||[];for(var r=0;r<a.length;r++)a[r].name==t&&(s=a[r]),i&&a[r].name==i&&(c=a[r])}var l={icon_id:t,in_use:!n,slot_no:o._slot_no,value:e,icon_info:s,old_icon_id:i,old_icon_info:c};o._tip.showTip(l,$(this))}),i.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),i.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var i=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),e=$(this).tbattr("data-level"),n=$(this).hasClass("icon_not_use"),_=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),a=o._icon_info["category_"+_],s=null,c=null;if(a){a=a.advanced||[];for(var r=0;r<a.length;r++)a[r].name==t&&(s=a[r]),i&&a[r].name==i&&(c=a[r])}var l={icon_id:t,in_use:!n,slot_no:o._slot_no,value:e,icon_info:s,old_icon_id:i,old_icon_info:c};o._tip.showTip(l,$(this))}}),i.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var i=this,t=$(".icon_book_tab_head li"),e=0;e<t.length;e++)if($(t[e]).tbattr("data-categoryId")==o)return e;return i._getDefaultIndex(i.defaultCategoryId)},_getDefaultCategoryId:function(o){var i="";for(var t in o)i=t;return i},_getDefaultIndex:function(o){for(var i=$(".icon_book_tab_head li"),t=0;t<i.length;t++)if($(i[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var i=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&i.bindArrowScrollEvent("icon_wrap");var e=$("#tab_content_"+o+" .collect_icon_wrap");e&&e.length>0&&i.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var i=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){i._move("left",o),i._tip&&i._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){i._move("right",o),i._tip&&i._tip.hideTip()})},_move:function(o,i){var t=this,e=0,n=$($(".tab_body_item_active ."+i+" .icon_view")[0]).tbattr("total-col");switch(n=parseInt(n),o){case"left":e=t._moveLeft(n,i);break;case"right":e=t._moveRight(n,i)}e&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:e},300);var _=55*n;e&&(e=Math.abs(parseInt(e)),e+550>=_?($(".tab_body_item_active ."+i+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+i+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+i+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+i+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==e&&($(".tab_body_item_active ."+i+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+i+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,i){var t=0,e=o;if(!(10>=e)){var n=55*e,_=$(".tab_body_item_active ."+i+" .icon_list").css("left"),a=Math.abs(parseInt(_));a%55!=0&&(a=a%55*55);var s=n-a;if(s>550)return t=a+165,"-"+t+"px"}},_moveRight:function(o,i){var t=0,e=o;if(!(10>=e)){var n=$(".tab_body_item_active ."+i+" .icon_list").css("left"),_=parseInt(n);if(!(_>=0))return t=Math.abs(_)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}}),_.Module.define({path:"user/widget/icons/icons_book_common",requires:[],sub:{initial:function(){},isDurationIcon:function(o){return o?4==o.type?!0:!1:!1},getIconExpired:function(o){var i=-1;if(!o)return i;var t=o.type,e=o.end_time,n=(new Date).getTime()/1e3;return 4==t&&e>=n&&(i=((e-n)/86400).toFixed(1)),i},isShowDurationIcon:function(o){if(!o)return!1;var i=o.type,t=o.end_time,e=(new Date).getTime()/1e3;return 4!=i?!0:t>=e?!0:!1}}}),_.Module.define({path:"user/widget/icons",requires:["user/widget/user_api","user/widget/icons/icons_book_common"],sub:{iconClassList:{0:"",1:"icon-crown-vip",2:["icon-crown-super-vip","icon-crown-super-v1","icon-crown-super-v2","icon-crown-super-v3","icon-crown-super-v4","icon-crown-super-v5"],3:["icon-crown-year-vip","icon-crown-year-v1","icon-crown-year-v2","icon-crown-year-v3","icon-crown-year-v4","icon-crown-year-v5"]},overdueSuperIconList:["icon-crown-super-non","icon-crown-super-non1","icon-crown-super-non2","icon-crown-super-non3","icon-crown-super-non4","icon-crown-super-non5"],initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.requireInstance("user/widget/icons/icons_book_common"),PageUnit.load("icons_category"),this.userApi=this.requireInstance("user/widget/user_api",[])},getCrownIconClass:function(o,i){var t=$.getPageData("vipInfo.v_level",0,o),e=this.userApi.getUniversalMemberLevelOf(o),n=$.getPageData("vipInfo.v_status",0,o);n=parseInt(n,10),e=3===n?3:e;var _="";if(i){if(this.userApi.checkOverdueSuperMembershipOf(o))return this.overdueSuperIconList[t];if(0===e)return _="icon-crown-super-non"}switch(e){case 0:_=this.iconClassList[e];break;case 1:_=this.iconClassList[e];break;case 2:case 3:_=this.iconClassList[e][t]}return _},getPreIconHtml:function(o,i,t){var e={};e.mParr_props=o,i=i||e;var n,_=["\u8d34\u5427\u4f1a\u5458","\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458"],a="",s=Math.round((new Date).getTime()/1e3),c=((new Date).getTime(),$.getPageData("forum.id",0)),r="";return this.userApi.checkSingleForumMembershipOf(i,c)&&(a='<div class="pre_icon_wrap pre_icon_wrap_theme"><a class="icon_tbworld icon-vip3-16" title="\u672c\u5427\u4f1a\u5458" href="/tbmall/tshow" onclick="return false" target="_blank"></a></div>'),o&&o.level&&o.level.end_time>s?(r=this.getCrownIconClass(i),a='<div class="pre_icon_wrap pre_icon_wrap_theme1">',n=$.getPageData("level.props_id",0,o),a+='<a class="icon_tbworld '+r+'" href="/tbmall/tshow" target="_blank" title="'+_[n-1]+'"></a>',a+="</div>"):t&&(r=this.getCrownIconClass(i,!0),a='<span class="pre_icon_wrap pre_icon_wrap_theme1">',n=$.getPageData("level.props_id",0,o),a+='<a class="icon_tbworld '+r+'" href="/tbmall/tshow" target="_blank" title="'+_[n-1]+'"></a>',a+="</span>"),a},getTbvipIconHtml:function(o,i,t){i=i?i:1,t=t?t:"";var e="";return o&&o.type&&(e='<span class="tbvip_icon_wrap tbvip_icon_wrap_theme'+i+" "+t+'"><a class="icon_tbvip icon_tbvip_type'+o.type+'" href="/tbvip/index"target="_blank" title="'+o.intro+'"></a></span>'),e},getIconsHtml:function(o,i,t,e){var n,_=$("<div>"),t=t?t:5,a=o.new_iconinfo,s=0;for(var c in a)s++;var r='<span class="icon_wrap  icon_wrap_theme1">',l=0;if(!a){var d=o.iconinfo;if(d){var u=d[0];n=this._getOldHtml(u,1),r+=e?_.html($(n).tbattr("data-field",this.getCommonIconDataNeed(u)).addClass("j_icon_slot")).html():n}}for(var b in a){var v=a[b];if(l==t)break;if($.isEmptyObject(v)){if("1"==b){var d=o.iconinfo;if(!$.isEmptyObject(d)){var u=this._getReplaceIcon(d,a);if(!u)continue;n=this._getOldHtml(u,1),r+=e?_.html($(n).tbattr("data-field",this.getCommonIconDataNeed(u)).addClass("j_icon_slot")).html():n,l++}}}else this.common.isShowDurationIcon(v)&&(n=this._getIconHtml(v,1),r+=e?_.html($(n).tbattr("data-field",this.getCommonIconDataNeed(v)).addClass("j_icon_slot")).html():n,l++)}return r+="</span>"},_getReplaceIcon:function(o,i){if($.isEmptyObject(i))return o[0];for(var t=0;t<o.length;t++){var e=o[t];if(!this._judgeIconInNewiconinfo(i,e))return e}return null},_judgeIconInNewiconinfo:function(o,i){if($.isEmptyObject(o))return!1;if($.isEmptyObject(i))return!1;for(var t in o){var e=o[t];if(e&&e.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94c1\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_lottery_2:"\u94dc\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_lottery_3:"\u94f6\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_lottery_4:"\u91d1\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_coreuser_1:"\u8d34\u5427\u6838\u5fc3\u7528\u6237",is_verify_1:"\u767e\u5ea6\u8d34\u5427\u5b98\u65b9\u5e73\u53f0\u8ba4\u8bc1",user_type_1:"\u8d34\u5427\u5b9e\u540d\u8ba4\u8bc1",is_battle_1:"\u8d34\u5427\u62f3\u738b",is_welfare_1:"\u798f\u5229\u5370\u8bb0"},_getOldHtml:function(o,i){var t="",e=o.sprite[o.value];if(!e)for(var n in o.sprite){if(o.sprite[n]&&(0!=o.value||"meizhi_level"==o.name)){e=o.sprite[n];break}return t}var _=o.icon+"?stamp="+e.split(",")[0];switch(background='style="background: url('+_+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+_+',sizingMethod=scale); background-size: 14px 14px"',o.name){case"meizhi_level":var a=o.value;a=a?a:0,a>=2&&(a-=2,t+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+o.meizhi_thread_id+'" target="_blank" title="\u8d34\u5427\u59b9\u7eb8\u8ba4\u8bc1"><span class="icon_meizhi meizhi_level_'+a+'"></span></a>');break;case"is_member":t+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7c89\u4e1d\u4f1a\u5458"></a>';break;default:t+=o.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+o.title_url+'"  title="'+o.title+'"  locate="'+o.name+"_"+o.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[o.name+"_"+o.value]+'"  locate="'+o.name+"_"+o.value+'"></span>'}return t},_getIconHtml:function(o,i){var t,e,n,_,a,i=i||1,s=50,c="",r="//tb1.bdst",l=r+"atic.com/tb/cms/com/icon/";if(t=o.sprite[o.value],!t)for(var d in o.sprite){if(o.sprite[d]&&(0!=o.value||"meizhi_level"==o.name)){t=o.sprite[d];break}return c}e=t.split(","),n=e[0],_=e[1];var u=l+o.category_id+"_"+this._imgSize[i]+".png?stamp="+n;switch(a='style="background: url('+u+") no-repeat -"+_*s+"px  -"+(i-1)*s+'px;"',o.name){case"meizhi_level":var b=o.value;b=b?b:0,b>=2&&(b-=2,c+="<a "+a+' class="maizhi_link" href="/p/'+o.meizhi_thread_id+'" target="_blank" title="\u8d34\u5427\u59b9\u7eb8\u8ba4\u8bc1"><span class="icon_meizhi meizhi_level_'+b+'"></span></a>');break;case"is_member":c+="<a "+a+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(o.title_url)c+="<a "+a+' target="_blank"  href="'+o.title_url+'"  title="'+o.title+'"  locate="'+o.name+"_"+o.value+'"> </a>';else{{o.title}c+="<span "+a+' title="'+o.title+'"  locate="'+o.name+"_"+o.value+'"></span>'}}return c},getCommonIconDataNeed:function(o){var i={};return i.name=o.name,i.end_time=o.end_time,i.category_id=o.category_id,i.slot_no=o.slot_no,i.title=o.title,i.intro=o.intro,i.intro_url=o.intro_url,i.price=o.price,i.value=o.value,i.sprite=o.sprite,JSON.stringify(i)}}});!function(){var e={},a={};_.Module.define({path:"encourage-payment/widget/base_user_data",requires:[],sub:{initial:function(r){r&&(r=$.extend({},r),e=r.scores||e,a=r.level||a)},route:{getTdou:"//tieba.baidu.com/tbmall/getUserTd"},_item_cache_last_total_tdou:0,_parrScores:null,_parrProps:null,getUserName:function(){return PageData.user.name||PageData.user.name_url},getUserTdou:function(){var e=window.EncourageData.userScore,a=(PageData.user,this._parrScores||e);return a&&!$.isEmptyObject(a)?a.scores_money+a.scores_other:0},getShowName:function(){return PageData.user.name_show||PageData.user.user_name},isMemeber:function(){var e=this._getMaxLevel(a);return!!e},getMemberLevel:function(){var e=this._getMaxLevel(a);return e},getMemberIcon:function(){var e=e||window.EncourageData.userLevel,a=this._getMaxLevelExpire(e),r=this.getMemberIconByLevel(a);return r},getMemberIconByLevel:function(e){var a=this;e&&(e=parseInt(e));var r="",t="",n="";switch(e){case-1:r=" icon-vip1-gray-18 base_member_icon",t="\u8d34\u5427\u4f1a\u5458",n="\u7eed\u8d39\u8d34\u5427\u4f1a\u5458";break;case 1:r=" icon-vip1-18 base_member_icon",t="\u7eed\u8d39\u8d34\u5427\u4f1a\u5458",n="\u5f00\u901a\u8d34\u5427\u4f1a\u5458";break;case-2:r=" icon-vip2-gray-18 base_member_icon",t="\u7eed\u8d39\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458",n="\u5f00\u901a\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458";break;case 2:r=" icon-vip2-18 base_member_icon",t="\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458",n="\u7eed\u8d39\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458";break;default:r="",t=""}var o={icon:r,title:t,action_title:n,level:a._getMaxLevel()};return o},isLogin:function(){return PageData.user.is_login},needUpdateTdou:function(){var r=a,t=e;return!(r&&t)},_getMaxLevel:function(e){var a=0,r=(new Date).getTime(),t=e||window.EncourageData.userLevel||{};return t&&1e3*t.end_time>r&&parseInt(t.props_id,10)>a&&(a=parseInt(t.props_id,10)),a},_getMaxLevelExpire:function(e){var a=0,r=(new Date).getTime(),t=e||window.EncourageData.userLevel;return t&&parseInt(t.props_id,10)>a&&(a=parseInt(t.props_id,10),1e3*t.end_time<=r&&(a=0-a)),a},getTdou:function(e,a,r){var t=this;t._get_tdou_ajax&&t._get_tdou_ajax.abort(),t._get_tdou_ajax=$.ajax({type:"get",url:t.route.getTdou+"?"+new Date,data:{},cache:!1,dataType:"json"}).success(function(t){e.call(a,t,r)})},getSimpleUserData:function(){return{mParr_props:{level:EncourageData.userLevel},Parr_scores:EncourageData.userScore,vipInfo:EncourageData.vipInfo}},getUserTreasure:function(){return window.EncourageData.userScore?window.EncourageData.userScore.treasure_coin_total||0:0}}})}();_.Module.define({path:"encourage-payment/widget/base_dialog_user_bar",requires:["encourage-payment/widget/base_user_data","user/widget/icons"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <div class="header_title">          <span class="header_icon"></span>          <span><%=title%></span>      </div>      <div class="user_info">              <span class="title_acc">\u8d26\u53f7\uff1a                  <%= userIcon %>                  <a class="title_acc_name <%=member_red%> "><%=user_name%></a>              </span>              <%if(is_tdou_info_display){%>              <span class="tdou_remain">T\u8c46\u4f59\u989d\uff1a                  <span class="tdou_remain_num">                      <span class="icon-tbean user_tdou_icon"></span>                      <span class="j_tdou"><%=tdou_num%></span>                  </span>                  </span>          <%}%>      </div>      <a class="header_close j_header_close"></a>  </div>',initial:function(){this.dataProxy=this.requireInstance("encourage-payment/widget/base_user_data"),this.member=this.dataProxy.getMemberIcon(),this.icon=this.requireInstance("user/widget/icons")},getUserBarTemplate:function(e){var a=this,s="",t=!0;e&&"getmember"==e?(s=a.member.action_title,t=!1):s="\u83b7\u53d6T\u8c46";var r="",i=a.member.icon;("ordinary_member_icon"==$.trim(i)||"super_member_icon"==$.trim(i)||i.indexOf("vip1-18")>0||i.indexOf("vip2-18")>0)&&(r=" member_red ");var n=this.dataProxy.getSimpleUserData(),_=this.icon.getPreIconHtml($.getPageData("mParr_props",{},n),n,!0),o={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:r,title:s,is_tdou_info_display:t,userIcon:_},d=window._.template(a.tpl,o);return d}}});_.Module.define({path:"encourage-payment/widget/qianbao_cashier_dialog",requires:["encourage-payment/widget/base_user_data"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"//zhifu.baidu.com/static/js/pc/iframe/lbscashier-iframe.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("encourage-payment/widget/base_user_data")},createMain:function(a,e){var t=this;window.qianbaoCashier=function(){return t}(),t.setLoading(),$.isFunction(e)&&e(t.$root),t.changeoPayAmount(a),t.qianbao_params_json=t.getParams(a)},buildCashier:function(a){var e=this;e.cashier?e.cashier.updateOrder(a):(e.cashier=new window.lbscashier({onmessage:e.onMessage,containerId:e.iframeContainerId,data:a,height:360}),$("#cashier-iframe").css({border:"none"}))},onMessage:function(a){var e=window.qianbaoCashier;if(!a)return console.log("onmessage null"),void 0;var t=a.type,i=a.data,o=a.option,n=o&&o.channel,s=!1;if("updateOrder"===t)e.clearPayLoading();else if("pay"===t)switch(i){case"submit":if("wechat"===n||"alipayqr"===n||"gameyeepay"===n||"mobileyeepay"===n)return;e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");var c="wechat"===n||"alipayqr"===n||"gameyeepay"===n||"mobileyeepay"===n?!0:!1;c?(s=!0,e.checkQrcodePaymentResult()):e.showPaymentTip(c)}else if("qrcodeAlipay"===t)switch(i){case"success":e.showPaymentTip(),e.track("alipay-qrcode-success")}else if("qrcodeWechat"===t)switch(i){case"success":e.showPaymentTip(),e.track("wechat-qrcode-success")}s||e.clearLoading()},getSmallUser:function(){var a=PageData.user.id,e=a%2;return!e},showDialog:function(a,e,t){var i=this,o=a.qianbao_params;i.product=a.product,$.JsLoadManager.loadUrl(i.qianbaoLbscashierUrl,function(){i.buildDialog(e),i.createMain(o,t)})},buildDialog:function(a){var e=this;if(e._iframe_dialog){if(!$(".qianbao_cashier_iframe_dialog").is(":hidden"))return;$(".qianbao_cashier_iframe_dialog").remove()}var t=e.getDialogTpl(a),i={modal:!0,showTitle:!1,fixed:!0,width:717,height:614,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:t};e._iframe_dialog=new $.dialog(i),e._iframe_dialog.show(),e._setBody(),e.$root=e._iframe_dialog.element,e.track("show")},_setBody:function(){$("body").css({height:$(window).height(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},getDialogTpl:function(a){var e=this,t='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><!-- htmlcs-disable -->  <div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                  <p class="j_loading_text">\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</p>              </td>          </tr>          </tbody>      </table>  </div><!-- htmlcs-disable -->  <div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                    <p class="j_loading_text">\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019~</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div><div class="qianbao_cashier_agreement">\u8bf7\u52a1\u5fc5\u5ba1\u9605\u5e76\u63a5\u53d7<a href="https://tieba.baidu.com/tb/vip_eula.html" target="baidu_tb_member_agreement">\u300a\u8d34\u5427\u4f1a\u5458\u670d\u52a1\u534f\u8bae\u300b</a>\u6240\u6709\u6761\u6b3e\uff0c\u5426\u5219\u60a8\u65e0\u6743\u4f7f\u7528\u672c\u670d\u52a1\u3002</div></div>',i={goodsShowTpl:a};return t=$.tb.format(t,i)},qianbaoSecure:function(){var a={};a.templist=[];var e="passport.baidu.com";return a.set_pass_domain=function(a){switch(a){case"passport.baidu.com":case"wappass.baidu.com":case"passport.rdtest.baidu.com":case"passport.qatest.baidu.com":e=a}},a.pin=function(e,t){var i=window.Image?new Image:document.craeteElement("img"),o=function(a){o=function(){},t&&t(a)};i.onload=function(){o()},i.onerror=function(){o("failed")},a.templist.push(i),i.src=e},a.checkAuthorication=function(e){function t(){i&&o&&e&&e()}var i=!1,o=!1;a.sync_login("www.baifubao.com",function(){i=!0,t()}),a.sync_login("wallet.baidu.com",function(){o=!0,t()})},a.sync_login=function(t,i){a.pin("https://"+e+"/v3/login/api/auth/?return_type=3&tpl=bp&u=https://"+t+"/api/0/sync_login/0",i)},a}(),changeoPayAmount:function(a){var e=this,t=a;e.qianbao_params_json=e.getParams(a),e.qianbaoSecure.checkAuthorication(function(){e.buildCashier(t)})},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),this._hideBody(),delete window.qianbaoCashier,clearTimeout(a.timerId),a.track("\u5173\u95ed\u7a97\u53e3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var o=i[0].split("=");e.orderId=o[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult("ok",function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},checkQrcodePaymentResult:function(){this.setLoading("check"),this.checkPaymentResult()},getPaymentResult:function(a,e,t){var i=this;i.setLoading();var o={order_id:i.qianbao_params_json.orderId},n={product:i.product,userName:i.dataProxy.getUserName()};i._checkPaymentResult&&i._checkPaymentResult.abort();var s=5,c=function(){s--,clearTimeout(i.checkPaymentId),i._checkPaymentResult=$.ajax({type:"GET",url:i.services.getOrder,data:o,dataType:"json"}).success(function(o){var r=o.data.db_money||0;r/=100;var d=o.data.scores_total;if(!d){var l=o.data.given_scores||0;d=1e3*r+l+i.dataProxy.getUserTdou()}n=$.extend(n,{payAmount:r.toFixed(2),totalScores:d,payTdou:(o.data.given_scores||0)+(o.data.db_money||0)});var _=o.data.member_info;if(_){var p="yyyy-MM-dd",u=1e3*parseInt(_.create_time),m=1e3*parseInt(_.end_time);n=$.extend(n,{create_time:$.dateFormat(new Date(u),p),end_time:$.dateFormat(new Date(m),p)})}0==o.no?(i.clearLoading(),clearTimeout(i.checkPaymentId),e&&e(n),s=5):s>0&&"ok"===a?i.checkPaymentId=setTimeout(c,1e3):(i.clearLoading(),t&&t(n))})};i.checkPaymentId=setTimeout(c,1e3)},setLoading:function(a){var e=this,t=e.$root.find(".j_qianbao_cashier_loading");if(!t.is(":visible")){var i={loading:"\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...",paying:"\u5f88\u52aa\u529b\u7684\u5145\u503c\u4e2d...",check:"\u67e5\u8be2\u5145\u503c\u7ed3\u679c\u4e2d..."};t.show(),t.find(".j_loading_text").html(i[a]||i.loading)}},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(a){var e=this,t=e.$root.find(".j_qianbao_payment_tip");1==t.length&&t.remove(),e.$root.find(".j_qianbao_cashier_dialog").append(baidu.template('<!-- htmlcs-disable -->  <section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <%if(isQuickPay){%>              <p class="description">\u60a8\u5df2\u6210\u529f\u652f\u4ed8</p>              <%} else {%>              <p class="description">\u8bf7\u5728\u65b0\u6253\u5f00\u9875\u9762\u4e0a\u5b8c\u6210\u5145\u503c</p>              <%}%>              <p class="description-tips">\u4ed8\u6b3e\u5b8c\u6210\u524d\u8bf7\u4e0d\u8981\u5173\u95ed\u6216\u5237\u65b0\u6b64\u7a97\u53e3</p>              <div class="center">                  <a class="btn_default btn_sub btn-middle j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8d25\uff0c\u91cd\u65b0\u652f\u4ed8</a>                  <a class="btn_default btn-middle btn-encourage j_pay_ok qianbao_pay_tip_btn">\u652f\u4ed8\u6210\u529f</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>',{isQuickPay:a})),t=e.$root.find(".j_qianbao_payment_tip"),t.find(".j_close").on("click",function(){e.hidePaymentTip(),e.getPaymentResult("fail",function(a){e.showPaymentSuccess(a)},function(){e.trigger("event_tdou_qianbao_pay_again")})}),t.find(".j_pay_ok").on("click",function(){e.checkPaymentResult(),e.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.remove()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83b7\u53d6\u6210\u529f\uff01</span>          <p style="text-align:center">\u60a8\u53ef\u4ee5\u5728<span class="pay_amount">\u6211\u7684T\u8c46\u94b1\u5305</span>\u4e2d\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</p>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503c\u6210\u529f\uff01</span>          <%}%>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8d26\u53f7\uff1a</label><%=userName%></p>      <p><label>\u83b7\u8d60T\u8c46\uff1a</label><span class="pay_amount"><%=payTdou%></span>T\u8c46</p>      <p><label>\u652f\u4ed8\u91d1\u989d\uff1a</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4f1a\u5458\u8d77\u59cb\u65e5\u671f\uff1a</label><span class="member_date"><%=create_time%></span></p>        <p><label>\u4f1a\u5458\u7ed3\u675f\u65e5\u671f\uff1a</label><span class="member_date"><%=end_time%></span></p>      <%}%>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_close ">              <%if(product == \'tdou\'){%>              \u7ee7\u7eed\u83b7\u53d6              <%}else if(product == \'member\'){%>              \u7ee7\u7eed\u5145\u503c              <%}%>          </a>      </div>      <p style="text-align:center"><span class=" second j_second">5</span>\u79d2\u540e\u5173\u95ed\u7a97\u53e3</p>  </div>',a);e.updateUserInfo(a.totalScores),e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83b7\u53d6\u5931\u8d25\uff01</span>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503c\u5931\u8d25\uff01</span>          <%}%>      </div>      <p><label>\u8d26\u53f7\uff1a</label><%=userName%></p>      <p><label>\u83b7\u8d60T\u8c46\uff1a</label><span class="pay_amount"><%=payTdou%></span>T\u8c46</p>      <p><label>\u652f\u4ed8\u91d1\u989d\uff1a</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_repay ">              <%if(product == \'tdou\'){%>              \u91cd\u65b0\u83b7\u53d6              <%}else if(product == \'member\'){%>              \u91cd\u65b0\u5145\u503c              <%}%>          </a>      </div>        <p style="text-align:center">          <span class="second j_second">5</span>\u79d2\u540e\u5173\u95ed\u7a97\u53e3          <a href="//tieba.baidu.com/hermes/feedback?category=pay">\u8fdb\u884c\u53cd\u9988</a>      </p>  </div>',a);e.showPaymentResult(t)},updateUserInfo:function(a){EncourageData.userScore.scores_total=a,this.$root.find(".j_tdou").html(a)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a));var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,o=function(){return i--,0==i?(e.closeDialog(),void 0):(t.html(i),e.timerId=setTimeout(o,1e3),void 0)};e.timerId=setTimeout(o,1e3),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){clearTimeout(e.timerId),e.$root.find(".qiaobao_pay_result_dialog").remove(),e.trigger("event_tdou_qianbao_pay_again")})},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"encourage-payment/widget/qianbao_purchase_member",requires:["encourage-payment/widget/qianbao_cashier_dialog","encourage-payment/widget/base_user_data","encourage-payment/widget/base_dialog_user_bar","tbui/widget/login_dialog"],sub:{$root:null,memberOptions:null,id:"qianbao_purchase_member",initial:function(){var e=this;window.pageUnit=window.pageUnit||{};var t=window.pageUnit;t[this.id]||(t[this.id]=$.ajax({url:"/theme/getPage",type:"GET",data:{id:["qianbao_purchase_member_hot_message","qianbao_purchase_member_member_types"]},dataType:"json"}).done(function(a){a=a.data||{},t[e.id]={hotMessage:a.qianbao_purchase_member_hot_message||"\u8fd8\u7b49\u4ec0\u4e48\u5347\u7ea7\u5e74\u8d39\u4f1a\u5458\uff0c\u7ecf\u9a8c\u589e\u957f\u66f4\u5feb\uff01",memberTypes:a.qianbao_purchase_member_member_types||"super, normal"},t[e.id].memberTypes=t[e.id].memberTypes.split(/\s*,\s*/g)}).fail(function(){t[e.id]={hotMessage:"\u8fd8\u7b49\u4ec0\u4e48\u5347\u7ea7\u5e74\u8d39\u4f1a\u5458\uff0c\u7ecf\u9a8c\u589e\u957f\u66f4\u5feb\uff01",memberTypes:["super","normal"]}})),e.cashierDialog=e.requireInstance("encourage-payment/widget/qianbao_cashier_dialog"),e.baseData=e.requireInstance("encourage-payment/widget/base_user_data"),e.baseDialogUserBar=this.requireInstance("encourage-payment/widget/base_dialog_user_bar"),e.vip3Src="//tb2.bdstatic.com/tb/img/tb-plus-vip3_8f36413.png",e.vip4Src="//tb2.bdstatic.com/tb/img/tb-plus-vip4_e08e4b7.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon(),1==t.member.level||-1==t.member.level?(t.initMemberId="1050001",t.initMemberCount="3"):(t.initMemberId="1050002",t.initMemberCount="3"),t.getPayMemberOrder(t.initMemberId,t.initMemberCount,function(e){var a={qianbao_params:e};t.showMember(a);var i=t.cashierDialog.getParams(e);t.orderId=i.orderId})},showMember:function(e){var t=this,a=window.pageUnit;if(a[this.id].done)return a[this.id]=a[this.id].done(function(){t.showMember(e)}),void 0;e.hotMessage=e.hotMessage||a[this.id].hotMessage,e.memberTypes=e.memberTypes||a[this.id].memberTypes;var i=e.qianbao_params||"",r=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),n=window.baidu.template('<!-- htmlcs-disable -->\r\n<div class="qianbao_cashier_purchase_member base_user_data">\r\n    <%- baseDialogUserBarTpl %>\r\n    <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">\r\n        <div class="member_wrap">\r\n            <label class="goods_title">\u9009\u62e9\u4f1a\u5458\uff1a</label>\r\n            <ul class="member_list j_member_list">\r\n                <% if(~$.inArray(\'super\', memberTypes)) { %>\r\n                <li class="member_item recommend j_order_update  j_type_1050002">\r\n                    <label class="member-type" id="ptype-1050002" data-name="\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458" data-value="1050002">\r\n                        <img src="<%- vip4Src %>">\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458\r\n                    </label>\r\n                </li>\r\n                <% } %>\r\n                <% if(~$.inArray(\'normal\', memberTypes)) { %>\r\n                <li class="member_item j_order_update j_type_1050001 <%- type_1050001 %>">\r\n                    <label class="member-type" id="ptype-1050001" data-name="\u8d34\u5427\u4f1a\u5458" data-value="1050001">\r\n                        <img src="<%- vip3Src %>">\r\n                        \u8d34\u5427\u4f1a\u5458\r\n                    </label>\r\n                </li>\r\n                <% } %>\r\n                <% if(memberTypes.length > 1) { %>\r\n                <li class="member-tips <%- type_1050001 %>">\r\n                    <p>\u8bf7\u9009\u62e9\u8d2d\u4e70\u5546\u54c1</p>\r\n                </li>\r\n                <% } %>\r\n            </ul>\r\n            <div class="form-explain default" style="display: none;"></div>\r\n            <div class="form-explain priority" style="display: none;">\u5f00\u901a\u4f1a\u5458\u540e\uff0c\u60a8\u5c06\u4f18\u5148\u4eab\u53d7\u8d85\u7ea7\u4f1a\u5458\u7279\u6743\uff0c\u8d85\u7ea7\u4f1a\u5458\u8fc7\u671f\u540e\u7ee7\u7eed\u4eab\u53d7\u539f\u666e\u901a\u4f1a\u5458\u7279\u6743</div>\r\n        </div>\r\n        <div class="member_time_wrap">\r\n            <label class="goods_title time-title">\u9009\u62e9\u65f6\u957f\uff1a</label>\r\n            <ul class="time_list j_time_list">\r\n                <li class="time_item  j_order_update j_time_item" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_1" id="vip_month_1" data-value="1">\r\n                        1\u4e2a\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="time_item j_order_update j_time_item" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_3" id="vip_month_3" data-value="3">\r\n                        3\u4e2a\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="time_item j_order_update j_time_item" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_6" id="vip_month_6" data-value="6">\r\n                        6\u4e2a\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="time_item j_order_update j_time_item j_vip_month_12" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_12" id="vip_month_12" data-value="12">\r\n                        12\u4e2a\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="custum_time j_custum_time">\r\n                    <label for="month-custum" class="month_custum">\r\n                        <input type="text" class="ui-input "\r\n                               name="month-custum" id="month-custum"\r\n                               placeholder="\u5176\u4ed6">\u4e2a\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="member-tips">\r\n                    <p>\u8bf7\u9009\u62e9\u65f6\u957f</p>\r\n                </li>\r\n            </ul>\r\n            <div class="form-error"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',r),s={qianbao_params:i,product:"member"};t.cashierDialog.showDialog(s,n,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount),t.bindEvents()})},initUI:function(e,t){var a=this;a.selectedUI(e,t)},selectedUI:function(e,t){var a=this;a.$root.find(".j_member_list li").removeClass("selected"),a.$root.find(".j_type_"+e).addClass("selected"),a.$root.find(".j_time_list li").removeClass("selected");var i=a.$root.find("#vip_month_"+t);i.length?(i.parents("li.j_time_item").addClass("selected"),a.$root.find("#month-custum").val("")):a.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120;e.$root.find(".qianbao_cashier_agreement a").on("click",function(e){e.stopPropagation(),$.stats.track("\u4ed8\u6b3e\u5f39\u7a97\u5e95\u90e8","\u5f00\u901a/\u7eed\u8d39\u4f1a\u5458\u670d\u52a1\u534f\u8bae\u70b9\u51fb",PageData.page?PageData.page:"other","click")}),e.$root.find(".j_order_update").on("click",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),i="",r="";if(a.hasClass("member-type"))i=a.data("value"),r=e.$root.find(".j_time_list li.selected .time-type").data("value"),r||(r=e.$root.find("#month-custum").val());else{if(!a.hasClass("time-type"))return!1;e.$root.find("#month-custum").val(""),r=a.data("value"),i=e.$root.find(".j_member_list li.selected .member-type").data("value")}e.selectedUI(i,r),e.updatePayUI(i,r)}),e.$root.find("#month-custum").on("input propertychange",function(){var a=/^[1-9]\d*$/,i=$(this),r=i.val();(r&&!a.test(r)||a.test(r)&&r>t)&&(r=r.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),r=Math.min(t,r),0==r&&(r=1),i.val(r));var n=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(n,r)}).on("focus",function(a){var i=$(a.target);e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading();var r=i.val(),n=/^[1-9]\d*$/;(r&&!n.test(r)||n.test(r)&&r>t)&&(r=r.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),r=Math.min(t,r),0==r&&(r=1),i.val(r));var s=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(s,r)}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,a){var i=this,r={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:i.return_url};i._getPayMemberAjax&&i._getPayMemberAjax.abort(),i._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:r,cache:!1,dataType:"json"}).success(function(e){if(0==e.no)a&&a(e.data.return_url);else if(e&&1990055===e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var t="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),r="https://passport";$.JsLoadManager.use([r+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(t/6e4),r+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(t/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else 11e4===+e.no&&i.requireInstance("tbui/widget/login_dialog")})},updatePayMemberOrder:function(e,t,a,i){var r=this,n={terminal:"pc",pay_type:1,channel:2,order_id:a,memberId:e,memberCount:t,pageUrl:r.return_url,fr:r.memberOptions.fr||""};r._upPayMemberAjax&&r._upPayMemberAjax.abort(),r._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:n,cache:!1,dataType:"json"}).success(function(e){0==e.no&&i&&i(e.data)})},createBubble:function(e){$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0})},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var a={content:"\u4e00\u6b21\u6027\u5f00\u901a12\u4e2a\u6708\u4ee5\u4e0a\u4f1a\u5458\uff0c\u8d60\u9001\u8fde\u7eed\u7b7e\u5230\u53613\u5f20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(a)}},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var a={content:"\u4e00\u6b21\u6027\u53ea\u80fd\u5f00\u901a120\u4e2a\u6708\u8d34\u5427\u4f1a\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(a)}},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"tbui/widget/messenger/messengerProcesser",requires:["tbui/widget/login_dialog"],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(e){this.checkExistCommand(e)&&(this.commandMap=$.extend(this.commandMap,e)),this.processFailCommand(e)},checkExistCommand:function(e){var i;for(i in e)if(e.hasOwnProperty(i)&&i in this.commandMap)return window.console&&console.warn('The command "'+i+'" is already exist'),void 0;return!0},processFailCommand:function(e){var i;for(i in e){var t=this._failCommandCacheList[i];e.hasOwnProperty(i)&&t&&this.process(t)}},process:function(e){if(!(e.command&&e.command in this.commandMap))return this._failCommandCacheList[e.command]=e,window.console&&console.warn("Please check or register the data processing command"),void 0;var i=this.commandMap[e.command];return i(e.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstance("tbui/widget/login_dialog")},common_register:function(e){var i=e.return_url||"//tieba.baidu.com",t="https://passport.baidu.com/v2/?reg&tpl=tb&u="+i;window.open(t)},exception_all:function(){throw new Error("Processing data exception")}}}),_.Module.define({path:"tbui/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,i,t){var n="";if(arguments.length<3?n="Target error: target and name are both requied":"object"!=typeof i?n="Target error: target itself must be window object":"string"!=typeof t&&(n="Target error: target name must be string type"),n)throw new Error(n);this.prefix=e,this.target=i,this.name=t},send:function(e){var i="postMessage"in window;if(i)this.target.postMessage(this.prefix+e,"*");else{var t=window.navigator[this.prefix+this.name];if("function"!=typeof t)throw new Error("Target error: target callback function is not defined");var n=$.tb.location,r={origin:n.getProtocol()+"//"+n.getHost(),data:this.prefix+e};t(r,window)}}}}),_.Module.define({path:"tbui/widget/messenger",requires:["tbui/widget/messenger/messengerProcesser","tbui/widget/messenger/messengerTarget"],sub:{initial:function(e,i){if(!e)throw new Error("Messenger name must be asigned");var t=i||"[PROJECT_NAME]";this.name=e,this.prefix=t.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("tbui/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,i){this.targets[i]=this.requireInstance("tbui/widget/messenger/messengerTarget",[this.prefix,e,i])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var i=0;for("string"==typeof e&&(e=[e]),i;i<e.length;i++)this.origins.push(e[i])},send:function(e){var i,t=this.targets;for(i in t)t.hasOwnProperty(i)&&t[i].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,i=function(i){var t="";if("object"==typeof i){if(!i.data||"string"!=typeof i.data)return window.console&&console.warn("The received message is not type of string"),void 0;if(t=i.data,/^ignoredProject/.test(t))return;if(t.substring(0,e.prefix.length)!==e.prefix)return window.console&&console.warn("The msg type is not avaliable in project "+e.prefix),void 0;if(i.origin&&!e._checkOrigin(i.origin))return window.console&&console.warn("The post origin is not avaliable in project "+e.prefix),void 0}else if(t=i,/^ignoredProject/.test(t))return;t=t.slice(e.prefix.length),t=e._escapeHTML(t);try{t=$.parseJSON(t)}catch(n){throw new Error("The JSON string is not valid")}var r=e.processer.process(t)||{};t.command&&t.shake&&t.shake_id&&e.send($.json.encode({command:t.command+"@"+t.shake_id+"@success",shake:!0,shake_id:t.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",i,!1):"attachEvent"in document&&window.attachEvent("onmessage",i):window.navigator[this.prefix+this.name]=i},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var i=0,t=this.origins.length;for(i;t>i;i++)if(this.origins[i]===e)return!0;return!1}}});_.Module.define({path:"encourage-payment/widget/cashier_dialog",requires:["encourage-payment/widget/base_user_data","tbui/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("encourage-payment/widget/base_user_data"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8d26\u53f7\uff1a<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8c46\u4f59\u989d\uff1a<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},this.pay_fr=e.fr,this.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,t={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5f00\u901a\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458"},r=a.buildCashierIframe(t),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:564,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:r};a._setBody(),a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,window.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},_setBody:function(){$("body").css({height:$(window).height(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=window.tdou_dianquan_iframe_dialog;e&&e.close(),this._hideBody(),delete window.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ed\u7a97\u53e3")},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("tbui/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652f\u4ed8\u6210\u529f");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518d\u6b21\u8d2d\u4e70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(this.pay_track||"memberpay","cashierDialog-"+this.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"encourage-payment/widget/pay_member",requires:["encourage-payment/widget/base_user_data","encourage-payment/widget/cashier_dialog","encourage-payment/widget/qianbao_purchase_member","encourage-payment/widget/TdouOpenType"],sub:{pay_member_url:"/tbmall/getPayUrl",PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(e){var a=this;e=$.extend({},e),a.requireInstance("encourage-payment/widget/base_user_data",{scores:e.scores,level:e.level}),a.cashierDialog=a.requireInstance("encourage-payment/widget/cashier_dialog"),a.qianbaoPayMember=a.requireInstance("encourage-payment/widget/qianbao_purchase_member"),a.openTypeList=a.requireInstance("encourage-payment/widget/TdouOpenType",{type:"member"})},showCashier:function(e){var a=this,t=e||{};$.extend(t,{fr:t.fr||"",track:"memberpay"}),this.opt=t,a._openCtrl("dialog"),a.payType=a.QIANBAO,a.payTypeCtrl()},_openCtrl:function(e){var a=this,t=a.openTypeList.getOpenType(a.opt.scene_id);switch(e="win"===e||"dialog"===e?e:t){case"win":a.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},openDialog:function(){var e=this.opt;this.payType==this.CASHIER?this.cashierDialog.showDialog(e):this.qianbaoPayMember.showDialog(e)},_getPayType:function(e){var a=this,t=this.opt.scene_id;e?(a.payType=e,a.payTypeCtrl()):(e=1,$.ajax({type:"GET",dataType:"json",url:a.PayMemberUrl,data:{terminal:"pc",pay_type:"member",id:t},success:function(t){0==t.no&&(e=Number(t.data.pay_type_id)||1),a.payType=e,a.payTypeCtrl()}}))},payTypeCtrl:function(){var e=this;e.win||e.payType!=e.QIANBAO?$.get("/tbmall/getPayUrl?terminal=pc&pay_type=1&fr="+this.opt.fr,function(a){if(a&&1990055===a.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var t="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(t/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(t/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else a.data&&(e.win?e.win.location.href=a.data:(a.data+="&embed=1",e.opt.cashier_url=a.data,e.openDialog()))}):e.openDialog()},isQianbaoHitSmallFlow:function(){var e=PageData&&PageData.user&&PageData.user.id;return e?"1157380926"==e||"707573940"==e||"963463500"==e||"1093896819"==e||"1496"==e||"1134652730"==e||"982451133"==e?!0:(e=parseInt(e),e%1===0):!0}}});F.module("common/widget/eventCenter",function(){var e=$({}),t=function(){var e;return e=("0000"+parseInt(Math.random()*Math.pow(36,4),10).toString(36)).slice(-4),function(t,n){var a,o,r,l,u,i,s,c,f;return a=navigator.userAgent.indexOf("MSIE ")>-1||navigator.userAgent.indexOf("Trident/")>-1,o="onstorage"in document&&a,r=function(e){var n;n=new Date,n.setTime(n.getTime()+1e3),document.cookie="tabHub_emit_"+t+"="+e+"; expires="+n.toUTCString()+"; path=/"},u=0,l=o?function(n){var a,o,l,i;for(c.lastValue=n,i="data:"+e+":"+c.lastValue,r(i),localStorage.setItem(t,i),a=0,o=s.length;o>a;a++)l=s[a],l.call(null,n);return u+=1}:function(n){var a,o,r;for(c.lastValue=n,localStorage.setItem(t,"data:"+e+":"+c.lastValue),a=0,o=s.length;o>a;a++)r=s[a],r.call(null,n);return u+=1},s=[],i=$.noop,o?$(document).on("storage.noop",i):$(window).on("storage.noop",i),n?(o&&r("readable:"+e),localStorage.setItem(t,"readable:"+e),$(document).ready(function(){return setTimeout(function(){return f(),u>0?void 0:(n(l),o?$(document).off("storage.noop"):$(window).off("storage.noop"))},100)})):$(document).ready(function(){setTimeout(function(){f(),$(document).off("storage.noop"),$(window).off("storage.noop")})}),f=function(){var n,l,u,i;return n=function(n){var a,o,r,l,u,i,f,d,g;if(u=n.originalEvent.key,f=localStorage.getItem(t),u===t&&f===n.originalEvent.newValue)switch(a=f.split(":"),r=a[0],o=a[2],r){case"readable":if(null!=c.lastValue)return localStorage.setItem(t,"data:"+e+":"+c.lastValue);break;case"data":if(null!=o){for(g=[],l=0,i=s.length;i>l;l++)d=s[l],g.push(d.call(null,o));return c.lastValue=o,g}}},i=function(n){var a,o,r,l,u,i,f,d,g,m;if(i=n.originalEvent.key,d=n.originalEvent.newValue,i===t){if(a=d.split(":"),l=a[0],r=a[1],o=a[2],r===e)return;switch(l){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")["0"]?localStorage.setItem(t,"data:"+e+":"+c.lastValue):void 0},0);break;case"data":if(null!=o){for(m=[],u=0,f=s.length;f>u;u++)g=s[u],m.push(g.call(null,o));return c.lastValue=o,m}}}},u=function(){var n,a,o,l,u,i,f,d,g;if(f=document.cookie.replace(RegExp("(?:(?:^|.*;\\s*)tabHub_emit_"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")){if(n=f.split(":"),l=n[0],o=n[1],a=n[2],o===e)return;if(null==f)return;switch(l){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n,a;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")["0"]?(a="data:"+e+":"+c.lastValue,r(a),localStorage.setItem(t,a)):void 0},0);break;case"data":if(null!=a){for(g=[],u=0,i=s.length;i>u;u++)d=s[u],g.push(d.call(null,a));return c.lastValue=a,g}}}},o?($(document).on("storage."+t,u),$(window).on("unload",function(){return $(document).off("storage")})):(l=a?i:n,$(window).on("storage."+t,l),$(window).on("unload",function(){return $(window).off("storage")}))},c={destory:function(){return $(window).off("storage."+t)},onValue:function(e){return s.push(e),function(){var t;return t=$.inArray(e,s),-1!==t?s.splice(t,1):void 0}},lastValue:null,emit:l,guid:e}}}();return e.TabHub=t,e});_.Module.define({require:["common/widget/eventCenter"],path:"common/widget/newMessageSystem",requires:["common/widget/Userbar/DropDownList"],sub:{favUrl:{get:"/sysmsg/userpost/queryStoreUpdateNum",clear:"/sysmsg/userpost/clearStoreUpdateNum"},favData:{type:"favts",category_name:"\u6211\u7684\u6536\u85cf",unread_count:0,category_href:"&type=storethread"},notifyData:[],messageData:[{type:"",category_name:"\u67e5\u770b\u79c1\u4fe1",unread_count:0,category_href:"/im/pcmsg"}],msgType:{reply:"1",atme:"2",friendapply:"3",fans:"4"},setNotifyStorage:function(e){$.tb.Storage.set(this.localStorageKey,$.json.encode(e),this.expire)},initial:function(e){this.options=e,this.$el=$(".userbar .u_news");var t=$('<div class="u_menu_item u_menu_news"><a href="#" class="u_news_wrap j_news" onclick="return false;">\u6d88\u606f<span></span><i class="i-arrow-down"></i></a></div>'),a=this.requireInstance("common/widget/Userbar/DropDownList",[this.$el,t]);this.$newsTips=t.find(".j_news span"),this.localStorageKey="notifyData"+PageData.user.id,this.expire=(new Date).getTime()+18e5,this.eventCenter=this.require("common/widget/eventCenter"),this.$el.append(t);var s=baidu.template('<div id="u_notify">     <div class="u_notity_bd">         <ul class="sys_notify j_sys_notify j_category_list">         </ul>         <ul class="sys_notify_last">             <li class="category_item  category_item_last j_category_item_last">                 <a target="_blank" href="/sysmsg/index?type=notity">                     \u6211\u7684\u901a\u77e5<span class="unread-num">0</span>                 </a>                 <ul class="new_message j_new_message j_category_list">                 </ul>             </li>         </ul>      </div> </div> ',{portrait:PageData.user.portrait});a.innerContent("top",s),this.$categoryList=this.$el.find(".j_category_list"),this.$systemNotifyList=this.$categoryList.eq(1),this.$systemMessageCountSpan=this.$el.find(".j_category_item_last .unread-num"),this.initLcs(),this.fetchNotifyList(),this.bindEvents()},initLcs:function(){TbCom.addEvent("User","infoComplete",function(){TbCom.process("UserMessage","init",null)})},fetchNotifyList:function(){var e=this,t=$.tb.Storage.get(this.localStorageKey),a=$("<a href="+document.referrer+"></a>")[0].host;return t&&document.referrer&&$.tb.location.getHost()===a?(t=$.json.decode(t),e.notifyData=t,e.renderNotify(t,1),void 0):($.getJSON("/sysmsg/query/userunread",function(t){var a=t.data;0===t.errno&&(e.notifyData=a,e.renderNotify(a,1),e.setNotifyStorage(a))}),void 0)},initMessagePanel:function(e){var t=this,a=[{type:"reply",category_name:"\u67e5\u770b\u56de\u590d",unread_count:e[3]||0,category_href:"&type=replyme"},{type:"atme",category_name:"\u67e5\u770b@\u63d0\u5230\u6211",unread_count:e[8]||0,category_href:"&type=atme"},{type:"friendapply",category_name:"\u67e5\u770b\u597d\u53cb\u7533\u8bf7",unread_count:e[21]||0,category_href:"&type=friendapply"},{type:"fans",category_name:"\u67e5\u770b\u65b0\u7c89\u4e1d",unread_count:e[0]||0,category_href:"&type=fans"}];a.push(this.favData),$.each(a,function(e,t){a[e].category_href="/i/sys/jump?u="+PageData.user.portrait+t.category_href}),a=[this.messageData[0]].concat(a),this.messageData=a,this.getFavNum(function(){t.renderNotify(t.messageData,0)})},renderNotify:function(e,t){0===t&&this.$categoryList.eq(t).html(baidu.template('<div id="u_notify_item">     <%for (var i = 0; i < list.length; i++) {%>     <li class="category_item <% if(list[i].unread_count == 0) {%>category_item_empty<%}%>">         <%if ( list[i].category_href ) {%>         <a class="j_cleardata" href="<%=list[i].category_href%>" target="_blank" data-type="<%=list[i].type%>"><%=list[i].category_name%>             <% if(list[i].unread_count != 0) {%>             <span class="unread-num"><%=list[i].unread_count%></span>             <% } %>         </a>         <%} else {%>         <a href="/sysmsg/index?type=notity&category_id=<%=list[i].category_id%>" target="_blank"            data-type="<%=list[i].type%>"><%=list[i].category_name%>             <% if(list[i].unread_count != 0) {%>             <span class="unread-num"><%=list[i].unread_count%></span>             <% } %>         </a>         <% } %>     </li>     <%}%> </div> ',{list:e})).find(".j_cleardata").eq(0).tbattr("target","sixin"),this.renderNotifyTips()},renderNotifyTips:function(){var e=this.getTotalMessageCount(),t=this.getSystemMessageCount();this.$systemMessageCountSpan.html(t);var a=e>99?"99+":e;this.$newsTips.html("("+a+")"),t?this.$systemMessageCountSpan.show():this.$systemMessageCountSpan.hide(),e>0?this.$newsTips.show():this.$newsTips.hide()},getTotalMessageCount:function(){var e=0;return e=this.getNotifyMessageCount()+this.getSystemMessageCount()},getNotifyMessageCount:function(){var e=0;return $.each(this.messageData,function(t,a){e+=parseInt(a.unread_count,10)}),e},getSystemMessageCount:function(){var e=0;return $.each(this.notifyData,function(t,a){e+=parseInt(a.unread_count,10)}),e},bindEvents:function(){var e=this;e.eventCenter.bind("sysmsg.readmsg",function(t,a){for(var s=0,n=e.notifyData.length;n>s;s++){var i=e.notifyData[s];if(a.category_id==i.category_id){i.unread_count=parseInt(i.unread_count,10)-1,i.unread_count<0&&(i.unread_count=0),e.renderNotify(e.notifyData,1),this.setNotifyStorage(e.notifyData);break}}}),TbCom.on("msgsystem_initall",function(t){e.initMessagePanel(t)}),TbCom.on("msgsystem_message",function(t){t=t[1]||{};var a=t.type,s=t.content;a&&"undefined"!=typeof s&&("all_msg"!==a?(e.messageData[e.msgType[a]].unread_count=parseInt(s,10),e.renderNotify(e.messageData,0)):e.initMessagePanel(s.split(",")))}),e.$categoryList.on("click",".j_cleardata",function(t){var a=$(t.currentTarget),s=a.tbattr("data-type");return"favts"===s?(e.clearFavNum(),void 0):(s&&TbCom.process("UserMessage","clearData",s),void 0)});var t=this.eventCenter.TabHub,a=t("messageCount",function(){a.getUnreadDebounce()});a.getUnreadDebounce=_.debounce(function(){$.ajax({url:"/im/pcmsg/query/getAllUnread",dataType:"json",cache:!1,type:"GET"}).done(function(e){0===parseInt(e.errno)&&a.emit(e.unread)})},100),a.onValue(function(t){e.messageData[0].unread_count=parseInt(t,10),e.renderNotify(e.messageData,0),$(document).off("visibilitychange.message"),$(window).off("focus.message")}),this.eventCenter.data("tabHub.message",a),$.lcsFlash&&$.lcsFlash.on(202006,function(e){return 6===e.multiMsg[0].data.groupType?document.hasFocus()||document.hidden===!1?(a.getUnreadDebounce(),void 0):("undefined"!=typeof document.hidden?$(document).off("visibilitychange.message").one("visibilitychange.message",a.getUnreadDebounce):$(window).off("focus.message").one("focus.message",a.getUnreadDebounce),void 0):void 0})},getFavNum:function(e){var t=this;$.get(this.favUrl.get,function(a){if(0===a.errno){t.favData.unread_count=a.num;var s=t.messageData[5];s&&(s.unread_count=a.num),t.renderNotify(t.messageData,0)}return $.isFunction(e)?(e.apply(t),void 0):void 0})},clearFavNum:function(){var e=this;$.get(this.favUrl.clear,function(t){if(0===t.errno){e.favData.unread_count=0;var a=e.messageData[5];a&&(a.unread_count=0),e.renderNotify(e.messageData,0)}})}}});_.Module.define({path:"encourage-member/widget/join_vip_dialog",requires:["tbui/widget/login_dialog","encourage-payment/widget/pay_member"],sub:{objGet:function(e,i,t){t=void 0===t?null:t,i=i.split(".");var o,n=e;for(o in i){if(!("object"==typeof n&&i[o]in n))return t;n=n[i[o]]}return n},objSet:function(e,i,t){return e[i]=t,e},initial:function(e){this.options=$.extend({},e)},getMemberDialog:function(e,i){return this.objGet(window,"PageData.user.is_login",!1)?(this.gotoCashier(e,i),!1):(this.requireInstance("tbui/widget/login_dialog"),!1)},gotoCashier:function(e,i){var t=this,o=this.requireInstance("encourage-payment/widget/pay_member",{scores:t.options.scores,level:t.options.level}),n=this.objSet({},"fr",e||"\u8d2d\u4e70\u4f1a\u5458");n=this.objSet(n,"scene_id",i||0),o.showCashier(n)}}});_.Module.define({path:"user/widget/user_head",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019","1100116","1100133","1100135"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>(new Date).getTime()/1e3?r.url:"https:"===document.location.protocol?"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait:"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",o=null,s={hasFrame:!1,stylestr:""};return i.end_time>(new Date).getTime()/1e3&&(e=i.props_id,o=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],s={hasFrame:!0,stylestr:o.join(";")}),s}}});_.Module.define({path:"tbui/widget/JsPager",sub:{_cfg:{},_amount:0,_center_pos:0,_jwrapper:null,_isNew:!0,_page_template:{normal:'<a href="#url#" index="#page#" #special#>#page#</a>',current:"<span #special#>#page#</span>",prev:'<a href="#url#" index="#page#" #special#>\u4e0a\u4e00\u9875</a>',next:'<a href="#url#" index="#page#" #special#>\u4e0b\u4e00\u9875</a>',head:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail:'<a href="#url#" index="#page#" #special#>\u5c3e\u9875</a>',prev_disable:'<a href="#url#" index="#page#" #special#>\u4e0a\u4e00\u9875</a>',next_disable:'<a href="#url#" index="#page#" #special#>\u4e0b\u4e00\u9875</a>',head_disable:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail_disable:'<a href="#url#" index="#page#" #special#>\u5c3e\u9875</a>',status:'<span #special#><span class="js_pager_idx">#page#</span>/<span class="js_pager_total">#total#</span></span>'},_default_cfg:{container:$("body"),amount:10,isHtml:!1,current:1,total:10,mode:0,url:"##",openInNew:!1,showStatus:!1,statusPos:"head",showDisableItem:!1,template:{},classname:{wrapper:"tbui_js_pager",normal:"",current:"current",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}},initial:function(e){var a=this;if(a._isNew){a._cfg=$.extend({},a._default_cfg,e);var t=a._cfg;t.template=$.extend({},a._page_template,t.template),t.amount=parseInt(t.amount),t.current=parseInt(t.current),t.total=parseInt(t.total),a._amount=t.total>t.amount?t.amount:t.total,a._center_pos=parseInt((a._amount+1)/2)}else a._cfg=$.extend(a._cfg,e);a._amount<=1||(a._cfg.isHtml||a._render(),a._isNew=!1)},_render:function(){var e=this,a=e._cfg,t=[],r="";if(a.showStatus&&"head"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),a.current>1?(t.push(e._generateHtml("head",1)),t.push(e._generateHtml("prev",a.current-1))):a.showDisableItem&&(t.push(e._generateHtml("head_disable",1)),t.push(e._generateHtml("prev_disable",a.current-1))),e._amount){var n,s,l,p;n=a.current-parseInt((e._amount-1)/2),s=a.current+e._center_pos,1>n?(l=1-n,n=1,s+=l,s=s>a.total?a.total:s):s>a.total&&(l=s-a.total,s=a.total,n-=l,n=1>n?1:n);for(var i=n;s>=i;i++)p=i==a.current?"current":"normal",t.push(e._generateHtml(p,i))}if(a.current<a.total?(t.push(e._generateHtml("next",a.current+1)),t.push(e._generateHtml("tail",a.total))):a.showDisableItem&&(t.push(e._generateHtml("next_disable",a.current+1)),t.push(e._generateHtml("tail_disable",a.total))),a.showStatus&&"tail"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),r=t.join(""),e._isNew&&(e._jwrapper=$("<div>",{"class":a.classname.wrapper}),e._jwrapper.bind("click",function(t){return"A"==t.target.nodeName&&("0"!==$(t.target).tbattr("ok")&&e.trigger("pageChange",parseInt($(t.target).tbattr("index"))),0==a.mode)?!1:void 0}),!a.isHtml)){var u="string"==typeof a.container?$("#"+a.container):$(a.container);u.empty(),u.append(this._jwrapper)}return a.isHtml?r:(e._jwrapper.html(r),void 0)},_generateHtml:function(e,a,t){var r="",n=this._cfg;r=n.template[e],r=r.replace(/#page#/g,a),r=r.replace(/#url#/g,n.url.replace(/\{page\}/g,a)),"undefined"!=typeof t&&(r=r.replace(/#total#/g,t));var s="";return n.classname[e]&&(s+='class="'+n.classname[e]+'"'),n.openInNew&&(s+=" target=_blank"),-1!==e.indexOf("disable")&&(s+=' ok="0"'),r=r.replace(/#special#/,s)}}});